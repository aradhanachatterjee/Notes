<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Notes - Week 3</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../pages/DBMS/w2.html">DBMS</a></li><li class="breadcrumb-item"><a href="../../pages/DBMS/w3.html">Week 3</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Notes</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Home</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">DBMS</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/DBMS/w2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/DBMS/w3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Week 3</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/DBMS/w4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 4</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">PDSA</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/PDSA/w2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">MAD-2</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/MAD-2/w1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/MAD-2/w2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 2</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../pages/MAD-2/w3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Week 3</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#lecture-3.1-sql-examples" id="toc-lecture-3.1-sql-examples" class="nav-link active" data-scroll-target="#lecture-3.1-sql-examples">Lecture 3.1: SQL Examples</a>
  <ul class="collapse">
  <li><a href="#select-distinct" id="toc-select-distinct" class="nav-link" data-scroll-target="#select-distinct">Select distinct</a></li>
  <li><a href="#select-all" id="toc-select-all" class="nav-link" data-scroll-target="#select-all">Select all</a></li>
  <li><a href="#cartesian-product" id="toc-cartesian-product" class="nav-link" data-scroll-target="#cartesian-product">Cartesian product</a></li>
  <li><a href="#rename-as-operation" id="toc-rename-as-operation" class="nav-link" data-scroll-target="#rename-as-operation">Rename AS Operation</a></li>
  <li><a href="#where-and-and-or" id="toc-where-and-and-or" class="nav-link" data-scroll-target="#where-and-and-or">Where: AND and OR</a></li>
  <li><a href="#string-operations" id="toc-string-operations" class="nav-link" data-scroll-target="#string-operations">String Operations</a></li>
  <li><a href="#order-by" id="toc-order-by" class="nav-link" data-scroll-target="#order-by">Order By</a></li>
  <li><a href="#in-operator" id="toc-in-operator" class="nav-link" data-scroll-target="#in-operator">In Operator</a></li>
  </ul></li>
  <li><a href="#set-operations-union" id="toc-set-operations-union" class="nav-link" data-scroll-target="#set-operations-union">Set Operations: union</a>
  <ul class="collapse">
  <li><a href="#set-operations-2-intersect" id="toc-set-operations-2-intersect" class="nav-link" data-scroll-target="#set-operations-2-intersect">Set Operations (2): intersect</a></li>
  <li><a href="#set-operations-3-except" id="toc-set-operations-3-except" class="nav-link" data-scroll-target="#set-operations-3-except">Set Operations (3): except</a></li>
  <li><a href="#aggregate-functions-avg" id="toc-aggregate-functions-avg" class="nav-link" data-scroll-target="#aggregate-functions-avg">Aggregate functions: avg</a></li>
  <li><a href="#aggregate-functions-2-min" id="toc-aggregate-functions-2-min" class="nav-link" data-scroll-target="#aggregate-functions-2-min">Aggregate functions (2): min</a></li>
  <li><a href="#aggregate-functions-3-max" id="toc-aggregate-functions-3-max" class="nav-link" data-scroll-target="#aggregate-functions-3-max">Aggregate functions (3): max</a></li>
  <li><a href="#aggregate-functions-4-count" id="toc-aggregate-functions-4-count" class="nav-link" data-scroll-target="#aggregate-functions-4-count">Aggregate functions (4): count</a></li>
  <li><a href="#aggregate-functions-5-sum" id="toc-aggregate-functions-5-sum" class="nav-link" data-scroll-target="#aggregate-functions-5-sum">Aggregate functions (5): sum</a></li>
  </ul></li>
  <li><a href="#lecture-3.2-intermediate-sql1" id="toc-lecture-3.2-intermediate-sql1" class="nav-link" data-scroll-target="#lecture-3.2-intermediate-sql1">Lecture 3.2: Intermediate SQL/1</a>
  <ul class="collapse">
  <li><a href="#nested-subqueries" id="toc-nested-subqueries" class="nav-link" data-scroll-target="#nested-subqueries">Nested Subqueries</a></li>
  <li><a href="#subqueries-in-the-where-clause" id="toc-subqueries-in-the-where-clause" class="nav-link" data-scroll-target="#subqueries-in-the-where-clause">Subqueries in the Where Clause</a></li>
  <li><a href="#set-membership" id="toc-set-membership" class="nav-link" data-scroll-target="#set-membership">Set Membership</a></li>
  <li><a href="#set-membership-2" id="toc-set-membership-2" class="nav-link" data-scroll-target="#set-membership-2">Set Membership (2)</a></li>
  <li><a href="#set-comparison---some-clause" id="toc-set-comparison---some-clause" class="nav-link" data-scroll-target="#set-comparison---some-clause">Set Comparison - “some” Clause</a></li>
  <li><a href="#definition-of-some-clause" id="toc-definition-of-some-clause" class="nav-link" data-scroll-target="#definition-of-some-clause">Definition of “some” Clause</a></li>
  <li><a href="#set-comparison---all-clause" id="toc-set-comparison---all-clause" class="nav-link" data-scroll-target="#set-comparison---all-clause">Set Comparison - “all” Clause</a></li>
  <li><a href="#definition-of-all-clause" id="toc-definition-of-all-clause" class="nav-link" data-scroll-target="#definition-of-all-clause">Definition of “all” Clause</a></li>
  <li><a href="#test-for-empty-relations-exists" id="toc-test-for-empty-relations-exists" class="nav-link" data-scroll-target="#test-for-empty-relations-exists">Test for Empty Relations: “exists”</a></li>
  <li><a href="#use-of-exists-clause" id="toc-use-of-exists-clause" class="nav-link" data-scroll-target="#use-of-exists-clause">Use of “exists” clause</a></li>
  <li><a href="#use-of-not-exists-clause" id="toc-use-of-not-exists-clause" class="nav-link" data-scroll-target="#use-of-not-exists-clause">Use of “not exists” clause</a></li>
  <li><a href="#test-for-absence-of-duplicate-tuples-unique" id="toc-test-for-absence-of-duplicate-tuples-unique" class="nav-link" data-scroll-target="#test-for-absence-of-duplicate-tuples-unique">Test for Absence of Duplicate Tuples: “unique”</a></li>
  <li><a href="#subqueries-in-the-from-clause" id="toc-subqueries-in-the-from-clause" class="nav-link" data-scroll-target="#subqueries-in-the-from-clause">Subqueries in the From Clause</a></li>
  <li><a href="#with-clause" id="toc-with-clause" class="nav-link" data-scroll-target="#with-clause">With Clause</a></li>
  <li><a href="#complex-queries-using-with-clause" id="toc-complex-queries-using-with-clause" class="nav-link" data-scroll-target="#complex-queries-using-with-clause">Complex Queries using With Clause</a></li>
  <li><a href="#scalar-subquery" id="toc-scalar-subquery" class="nav-link" data-scroll-target="#scalar-subquery">Scalar Subquery</a></li>
  <li><a href="#modification-of-the-database" id="toc-modification-of-the-database" class="nav-link" data-scroll-target="#modification-of-the-database">Modification of the Database</a></li>
  <li><a href="#deletion" id="toc-deletion" class="nav-link" data-scroll-target="#deletion">Deletion</a></li>
  <li><a href="#insertion" id="toc-insertion" class="nav-link" data-scroll-target="#insertion">Insertion</a></li>
  <li><a href="#updates" id="toc-updates" class="nav-link" data-scroll-target="#updates">Updates</a></li>
  <li><a href="#case-statement-for-conditional-updates" id="toc-case-statement-for-conditional-updates" class="nav-link" data-scroll-target="#case-statement-for-conditional-updates">Case Statement for Conditional Updates</a></li>
  <li><a href="#updates-with-scalar-subqueries" id="toc-updates-with-scalar-subqueries" class="nav-link" data-scroll-target="#updates-with-scalar-subqueries">Updates with Scalar Subqueries</a></li>
  </ul></li>
  <li><a href="#lecture-3.3-intermediate-sql2" id="toc-lecture-3.3-intermediate-sql2" class="nav-link" data-scroll-target="#lecture-3.3-intermediate-sql2">Lecture 3.3: Intermediate SQL/2</a>
  <ul class="collapse">
  <li><a href="#join-relations" id="toc-join-relations" class="nav-link" data-scroll-target="#join-relations">Join Relations</a></li>
  <li><a href="#types-of-joins-between-relations" id="toc-types-of-joins-between-relations" class="nav-link" data-scroll-target="#types-of-joins-between-relations">Types of Joins between Relations</a></li>
  <li><a href="#cross-join" id="toc-cross-join" class="nav-link" data-scroll-target="#cross-join">Cross Join</a></li>
  <li><a href="#join-operations---example" id="toc-join-operations---example" class="nav-link" data-scroll-target="#join-operations---example">Join Operations - Example</a></li>
  <li><a href="#inner-join" id="toc-inner-join" class="nav-link" data-scroll-target="#inner-join">Inner Join</a></li>
  <li><a href="#outer-join" id="toc-outer-join" class="nav-link" data-scroll-target="#outer-join">Outer Join</a></li>
  <li><a href="#left-outer-join" id="toc-left-outer-join" class="nav-link" data-scroll-target="#left-outer-join">Left Outer Join</a></li>
  <li><a href="#right-outer-join" id="toc-right-outer-join" class="nav-link" data-scroll-target="#right-outer-join">Right Outer Join</a></li>
  <li><a href="#joined-relations" id="toc-joined-relations" class="nav-link" data-scroll-target="#joined-relations">Joined Relations</a></li>
  <li><a href="#full-outer-join" id="toc-full-outer-join" class="nav-link" data-scroll-target="#full-outer-join">Full Outer Join</a></li>
  <li><a href="#joining-relations---examples" id="toc-joining-relations---examples" class="nav-link" data-scroll-target="#joining-relations---examples">Joining Relations - Examples</a></li>
  <li><a href="#views" id="toc-views" class="nav-link" data-scroll-target="#views">Views</a></li>
  <li><a href="#view-definition" id="toc-view-definition" class="nav-link" data-scroll-target="#view-definition">View Definition</a></li>
  <li><a href="#example-views" id="toc-example-views" class="nav-link" data-scroll-target="#example-views">Example Views</a></li>
  <li><a href="#views-defined-using-other-views" id="toc-views-defined-using-other-views" class="nav-link" data-scroll-target="#views-defined-using-other-views">Views Defined Using Other Views</a></li>
  <li><a href="#view-expansion" id="toc-view-expansion" class="nav-link" data-scroll-target="#view-expansion">View Expansion</a></li>
  <li><a href="#view-defined-using-other-views" id="toc-view-defined-using-other-views" class="nav-link" data-scroll-target="#view-defined-using-other-views">View Defined Using Other Views</a></li>
  <li><a href="#view-expansion-1" id="toc-view-expansion-1" class="nav-link" data-scroll-target="#view-expansion-1">View Expansion*</a></li>
  <li><a href="#update-of-a-view" id="toc-update-of-a-view" class="nav-link" data-scroll-target="#update-of-a-view">Update of a View</a></li>
  <li><a href="#some-updates-cannot-be-translated-uniquely" id="toc-some-updates-cannot-be-translated-uniquely" class="nav-link" data-scroll-target="#some-updates-cannot-be-translated-uniquely">Some Updates cannot be Translated Uniquely</a></li>
  <li><a href="#and-some-not-at-all" id="toc-and-some-not-at-all" class="nav-link" data-scroll-target="#and-some-not-at-all">And Some Not at All</a></li>
  <li><a href="#materialized-views" id="toc-materialized-views" class="nav-link" data-scroll-target="#materialized-views">Materialized Views</a></li>
  </ul></li>
  <li><a href="#lecture-3.4-intermediate-sql3" id="toc-lecture-3.4-intermediate-sql3" class="nav-link" data-scroll-target="#lecture-3.4-intermediate-sql3">Lecture 3.4: Intermediate SQL/3</a>
  <ul class="collapse">
  <li><a href="#transactions" id="toc-transactions" class="nav-link" data-scroll-target="#transactions">Transactions</a></li>
  <li><a href="#integrity-constraints" id="toc-integrity-constraints" class="nav-link" data-scroll-target="#integrity-constraints">Integrity Constraints</a></li>
  <li><a href="#integrity-constraints-on-a-single-relation" id="toc-integrity-constraints-on-a-single-relation" class="nav-link" data-scroll-target="#integrity-constraints-on-a-single-relation">Integrity Constraints on a Single Relation</a></li>
  <li><a href="#not-null-and-unique-constraints" id="toc-not-null-and-unique-constraints" class="nav-link" data-scroll-target="#not-null-and-unique-constraints">Not Null and Unique Constraints</a></li>
  <li><a href="#the-check-clause" id="toc-the-check-clause" class="nav-link" data-scroll-target="#the-check-clause">The check clause</a></li>
  <li><a href="#referential-integrity" id="toc-referential-integrity" class="nav-link" data-scroll-target="#referential-integrity">Referential Integrity</a></li>
  <li><a href="#cascading-actions-in-referential-integrity" id="toc-cascading-actions-in-referential-integrity" class="nav-link" data-scroll-target="#cascading-actions-in-referential-integrity">Cascading Actions in Referential Integrity</a></li>
  <li><a href="#integrity-constraint-violation-during-transactions" id="toc-integrity-constraint-violation-during-transactions" class="nav-link" data-scroll-target="#integrity-constraint-violation-during-transactions">Integrity Constraint Violation During Transactions</a></li>
  <li><a href="#built-in-data-types-in-sql" id="toc-built-in-data-types-in-sql" class="nav-link" data-scroll-target="#built-in-data-types-in-sql">Built-in Data Types in SQL</a></li>
  <li><a href="#index-creation" id="toc-index-creation" class="nav-link" data-scroll-target="#index-creation">Index Creation</a></li>
  <li><a href="#user-defined-types" id="toc-user-defined-types" class="nav-link" data-scroll-target="#user-defined-types">User Defined Types</a></li>
  <li><a href="#domains" id="toc-domains" class="nav-link" data-scroll-target="#domains">Domains</a></li>
  <li><a href="#large-object-types" id="toc-large-object-types" class="nav-link" data-scroll-target="#large-object-types">Large-Object Types</a></li>
  <li><a href="#authorization" id="toc-authorization" class="nav-link" data-scroll-target="#authorization">Authorization</a></li>
  <li><a href="#authorization-specification-in-sql" id="toc-authorization-specification-in-sql" class="nav-link" data-scroll-target="#authorization-specification-in-sql">Authorization Specification in SQL</a></li>
  <li><a href="#privileges-in-sql" id="toc-privileges-in-sql" class="nav-link" data-scroll-target="#privileges-in-sql">Privileges in SQL</a></li>
  <li><a href="#revoking-authorization-in-sql" id="toc-revoking-authorization-in-sql" class="nav-link" data-scroll-target="#revoking-authorization-in-sql">Revoking Authorization in SQL</a></li>
  <li><a href="#roles" id="toc-roles" class="nav-link" data-scroll-target="#roles">Roles</a></li>
  <li><a href="#authorization-on-views" id="toc-authorization-on-views" class="nav-link" data-scroll-target="#authorization-on-views">Authorization on Views</a></li>
  <li><a href="#other-authorization-features" id="toc-other-authorization-features" class="nav-link" data-scroll-target="#other-authorization-features">Other Authorization Features</a></li>
  </ul></li>
  <li><a href="#lecture-3.5-advanced-sql" id="toc-lecture-3.5-advanced-sql" class="nav-link" data-scroll-target="#lecture-3.5-advanced-sql">Lecture 3.5: Advanced SQL</a>
  <ul class="collapse">
  <li><a href="#native-language-query-language" id="toc-native-language-query-language" class="nav-link" data-scroll-target="#native-language-query-language">Native Language ← → Query Language</a></li>
  <li><a href="#functions-and-procedures" id="toc-functions-and-procedures" class="nav-link" data-scroll-target="#functions-and-procedures">Functions and Procedures</a></li>
  <li><a href="#sql-functions" id="toc-sql-functions" class="nav-link" data-scroll-target="#sql-functions">SQL Functions</a></li>
  <li><a href="#sql-functions-2" id="toc-sql-functions-2" class="nav-link" data-scroll-target="#sql-functions-2">SQL Functions (2)</a></li>
  <li><a href="#table-functions" id="toc-table-functions" class="nav-link" data-scroll-target="#table-functions">Table Functions</a></li>
  <li><a href="#sql-procedures" id="toc-sql-procedures" class="nav-link" data-scroll-target="#sql-procedures">SQL Procedures</a></li>
  <li><a href="#language-constructs-for-procedures-and-functions" id="toc-language-constructs-for-procedures-and-functions" class="nav-link" data-scroll-target="#language-constructs-for-procedures-and-functions">Language Constructs for Procedures and Functions</a></li>
  <li><a href="#language-constructs-2-while-and-repeat" id="toc-language-constructs-2-while-and-repeat" class="nav-link" data-scroll-target="#language-constructs-2-while-and-repeat">Language Constructs (2): while and repeat</a></li>
  <li><a href="#language-constructs-3-for" id="toc-language-constructs-3-for" class="nav-link" data-scroll-target="#language-constructs-3-for">Language Constructs (3): for</a></li>
  <li><a href="#language-constructs-4-if-then-else" id="toc-language-constructs-4-if-then-else" class="nav-link" data-scroll-target="#language-constructs-4-if-then-else">Language Constructs (4): if-then-else</a></li>
  <li><a href="#language-constructs-5-simple-case" id="toc-language-constructs-5-simple-case" class="nav-link" data-scroll-target="#language-constructs-5-simple-case">Language Constructs (5): Simple case</a></li>
  <li><a href="#language-constructs-6-searched-case" id="toc-language-constructs-6-searched-case" class="nav-link" data-scroll-target="#language-constructs-6-searched-case">Language Constructs (6): Searched case</a></li>
  <li><a href="#language-constructs-7-exception" id="toc-language-constructs-7-exception" class="nav-link" data-scroll-target="#language-constructs-7-exception">Language Constructs (7): Exception</a></li>
  <li><a href="#external-language-routines" id="toc-external-language-routines" class="nav-link" data-scroll-target="#external-language-routines">External Language Routines*</a></li>
  <li><a href="#external-language-routines-2" id="toc-external-language-routines-2" class="nav-link" data-scroll-target="#external-language-routines-2">External Language Routines (2)*</a></li>
  <li><a href="#external-language-routines-3-security" id="toc-external-language-routines-3-security" class="nav-link" data-scroll-target="#external-language-routines-3-security">External Language Routines (3)*: Security</a></li>
  <li><a href="#trigger" id="toc-trigger" class="nav-link" data-scroll-target="#trigger">Trigger</a></li>
  <li><a href="#types-of-triggers-before" id="toc-types-of-triggers-before" class="nav-link" data-scroll-target="#types-of-triggers-before">Types of Triggers: BEFORE</a></li>
  <li><a href="#types-of-triggers-2-after" id="toc-types-of-triggers-2-after" class="nav-link" data-scroll-target="#types-of-triggers-2-after">Types of Triggers (2): AFTER</a></li>
  <li><a href="#row-level-and-statement-level-triggers" id="toc-row-level-and-statement-level-triggers" class="nav-link" data-scroll-target="#row-level-and-statement-level-triggers">Row Level and Statement Level Triggers</a></li>
  <li><a href="#triggering-events-and-actions-in-sql" id="toc-triggering-events-and-actions-in-sql" class="nav-link" data-scroll-target="#triggering-events-and-actions-in-sql">Triggering Events and Actions in SQL</a></li>
  <li><a href="#triggering-to-maintain-credits_earned-value" id="toc-triggering-to-maintain-credits_earned-value" class="nav-link" data-scroll-target="#triggering-to-maintain-credits_earned-value">Triggering to Maintain credits_earned value</a></li>
  <li><a href="#how-to-use-triggers" id="toc-how-to-use-triggers" class="nav-link" data-scroll-target="#how-to-use-triggers">How to use triggers?</a></li>
  <li><a href="#how-not-to-use-triggers" id="toc-how-not-to-use-triggers" class="nav-link" data-scroll-target="#how-not-to-use-triggers">How not to use triggers?</a></li>
  <li><a href="#how-to-use-triggers-2" id="toc-how-to-use-triggers-2" class="nav-link" data-scroll-target="#how-to-use-triggers-2">How to use triggers? (2)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../pages/DBMS/w2.html">DBMS</a></li><li class="breadcrumb-item"><a href="../../pages/DBMS/w3.html">Week 3</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Week 3</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Click here to view in presentation mode: <a href="w3-slides.html">DBMS - Week 3</a></p>
</div>
</div>
<section id="lecture-3.1-sql-examples" class="level1">
<h1>Lecture 3.1: SQL Examples</h1>
<section id="select-distinct" class="level2">
<h2 class="anchored" data-anchor-id="select-distinct">Select distinct</h2>
<ul>
<li>From the <code>classroom</code> relation, find the names of buildings in which every individual classroom has capacity less than 100 (removing the duplicates).</li>
</ul>
<div id="cell-10" class="cell" data-execution_count="3">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="3">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">room_number</th>
<th data-quarto-table-cell-role="th">capacity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packard</td>
<td>101</td>
<td>500</td>
</tr>
<tr class="even">
<td>Painter</td>
<td>514</td>
<td>10</td>
</tr>
<tr class="odd">
<td>Taylor</td>
<td>3128</td>
<td>70</td>
</tr>
<tr class="even">
<td>Watson</td>
<td>100</td>
<td>30</td>
</tr>
<tr class="odd">
<td>Watson</td>
<td>120</td>
<td>50</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-11" class="cell" data-execution_count="59">
<div class="cell-output cell-output-stdout">
<pre><code>('Packard', '101', 500)
('Painter', '514', 10)
('Taylor', '3128', 70)
('Watson', '100', 30)
('Watson', '120', 50)</code></pre>
</div>
</div>
<p>Query:</p>
<div id="cell-13" class="cell" data-execution_count="4">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="4">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Painter</td>
</tr>
<tr class="even">
<td>Taylor</td>
</tr>
<tr class="odd">
<td>Watson</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-14" class="cell" data-execution_count="30">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
</div>
<div id="cell-15" class="cell" data-execution_count="31">
<div class="cell-output cell-output-display" data-execution_count="31">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Painter</td>
</tr>
<tr class="even">
<td>Taylor</td>
</tr>
<tr class="odd">
<td>Watson</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="60">
<div class="cell-output cell-output-stdout">
<pre><code>('Painter',)
('Taylor',)
('Watson',)</code></pre>
</div>
</div>
</section>
<section id="select-all" class="level2">
<h2 class="anchored" data-anchor-id="select-all">Select all</h2>
<ul>
<li>From the <code>classroom</code> relation, find the names of buildings in which every individual classroom has a capacity of less than 100 (without removing the duplicates).</li>
</ul>
<div id="cell-18" class="cell" data-execution_count="5">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="5">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">room_number</th>
<th data-quarto-table-cell-role="th">capacity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packard</td>
<td>101</td>
<td>500</td>
</tr>
<tr class="even">
<td>Painter</td>
<td>514</td>
<td>10</td>
</tr>
<tr class="odd">
<td>Taylor</td>
<td>3128</td>
<td>70</td>
</tr>
<tr class="even">
<td>Watson</td>
<td>100</td>
<td>30</td>
</tr>
<tr class="odd">
<td>Watson</td>
<td>120</td>
<td>50</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Query:</p>
<div id="cell-20" class="cell" data-execution_count="7">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="7">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Painter</td>
</tr>
<tr class="even">
<td>Taylor</td>
</tr>
<tr class="odd">
<td>Watson</td>
</tr>
<tr class="even">
<td>Watson</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Note that duplicate retention is the default and hence it is a common practice to skip <code>all</code> immediately after <code>select</code>.</li>
</ul>
</section>
<section id="cartesian-product" class="level2">
<h2 class="anchored" data-anchor-id="cartesian-product">Cartesian product</h2>
<div id="cell-23" class="cell" data-execution_count="10">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">budget</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Biology</td>
<td>Watson</td>
<td>90000</td>
</tr>
<tr class="even">
<td>Comp. Sci.</td>
<td>Taylor</td>
<td>100000</td>
</tr>
<tr class="odd">
<td>Elec. Eng.</td>
<td>Taylor</td>
<td>85000</td>
</tr>
<tr class="even">
<td>Finance</td>
<td>Painter</td>
<td>120000</td>
</tr>
<tr class="odd">
<td>History</td>
<td>Painter</td>
<td>50000</td>
</tr>
<tr class="even">
<td>Music</td>
<td>Packard</td>
<td>80000</td>
</tr>
<tr class="odd">
<td>Physics</td>
<td>Watson</td>
<td>70000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-24" class="cell" data-execution_count="11">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="11">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">tot_cred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>00128</td>
<td>Zhang</td>
<td>Comp. Sci.</td>
<td>102</td>
</tr>
<tr class="even">
<td>12345</td>
<td>Shankar</td>
<td>Comp. Sci.</td>
<td>32</td>
</tr>
<tr class="odd">
<td>19991</td>
<td>Brandt</td>
<td>History</td>
<td>80</td>
</tr>
<tr class="even">
<td>23121</td>
<td>Chavez</td>
<td>Finance</td>
<td>110</td>
</tr>
<tr class="odd">
<td>44553</td>
<td>Peltier</td>
<td>Physics</td>
<td>56</td>
</tr>
<tr class="even">
<td>45678</td>
<td>Levy</td>
<td>Physics</td>
<td>46</td>
</tr>
<tr class="odd">
<td>54321</td>
<td>Williams</td>
<td>Comp. Sci.</td>
<td>54</td>
</tr>
<tr class="even">
<td>55739</td>
<td>Sanchez</td>
<td>Music</td>
<td>38</td>
</tr>
<tr class="odd">
<td>70557</td>
<td>Snow</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr class="even">
<td>76543</td>
<td>Brown</td>
<td>Comp. Sci.</td>
<td>58</td>
</tr>
<tr class="odd">
<td>76653</td>
<td>Aoi</td>
<td>Elec. Eng.</td>
<td>60</td>
</tr>
<tr class="even">
<td>98765</td>
<td>Bourikas</td>
<td>Elec. Eng.</td>
<td>98</td>
</tr>
<tr class="odd">
<td>98988</td>
<td>Tanaka</td>
<td>Biology</td>
<td>120</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Find the list of all students of departments which have a budget &lt; $0.1million</li>
</ul>
<div id="cell-26" class="cell" data-execution_count="13">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="13">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">budget</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Brandt</td>
<td>50000</td>
</tr>
<tr class="even">
<td>Peltier</td>
<td>70000</td>
</tr>
<tr class="odd">
<td>Levy</td>
<td>70000</td>
</tr>
<tr class="even">
<td>Sanchez</td>
<td>80000</td>
</tr>
<tr class="odd">
<td>Snow</td>
<td>70000</td>
</tr>
<tr class="even">
<td>Aoi</td>
<td>85000</td>
</tr>
<tr class="odd">
<td>Bourikas</td>
<td>85000</td>
</tr>
<tr class="even">
<td>Tanaka</td>
<td>90000</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>The above query first generates every possible student-department pair, which is the Cartesian product of the <code>student</code> and <code>department</code> relations. Then, it filters out all the rows with student.dept_name = department.dept_name <strong>and</strong> department.budget &lt; 100000.</li>
<li>The common attribute <code>dept_name</code> in the resulting table is renamed using the relation name - student.dept_name and department.dept_name.</li>
</ul>
</section>
<section id="rename-as-operation" class="level2">
<h2 class="anchored" data-anchor-id="rename-as-operation">Rename AS Operation</h2>
<ul>
<li>The same query above can be framed by renaming the tables as follows:</li>
</ul>
<div id="cell-29" class="cell" data-execution_count="14">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="14">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">studentname</th>
<th data-quarto-table-cell-role="th">deptbudget</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Brandt</td>
<td>50000</td>
</tr>
<tr class="even">
<td>Peltier</td>
<td>70000</td>
</tr>
<tr class="odd">
<td>Levy</td>
<td>70000</td>
</tr>
<tr class="even">
<td>Sanchez</td>
<td>80000</td>
</tr>
<tr class="odd">
<td>Snow</td>
<td>70000</td>
</tr>
<tr class="even">
<td>Aoi</td>
<td>85000</td>
</tr>
<tr class="odd">
<td>Bourikas</td>
<td>85000</td>
</tr>
<tr class="even">
<td>Tanaka</td>
<td>90000</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>The above query renames the relations <code>student</code> and <code>department</code> as <code>S</code> and <code>D</code> respectively</li>
<li>It also displays the attribute <code>name</code> as <code>StudentName</code> and <code>budget</code> as <code>DeptBudget</code></li>
<li>Note that the budget attribute does not have any prefix because it occurs only in the department relation.</li>
</ul>
</section>
<section id="where-and-and-or" class="level2">
<h2 class="anchored" data-anchor-id="where-and-and-or">Where: AND and OR</h2>
<ul>
<li>From the <code>instructor</code> and <code>department</code> relations, find out the names of all instructors whose department is Finance <em>or</em> whose department is in any of the following buildings: Watson, Taylor.</li>
</ul>
<div id="cell-32" class="cell" data-execution_count="15">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="15">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10101</td>
<td>Srinivasan</td>
<td>Comp. Sci.</td>
<td>65000</td>
</tr>
<tr class="even">
<td>12121</td>
<td>Wu</td>
<td>Finance</td>
<td>90000</td>
</tr>
<tr class="odd">
<td>15151</td>
<td>Mozart</td>
<td>Music</td>
<td>40000</td>
</tr>
<tr class="even">
<td>22222</td>
<td>Einstein</td>
<td>Physics</td>
<td>95000</td>
</tr>
<tr class="odd">
<td>32343</td>
<td>El Said</td>
<td>History</td>
<td>60000</td>
</tr>
<tr class="even">
<td>33456</td>
<td>Gold</td>
<td>Physics</td>
<td>87000</td>
</tr>
<tr class="odd">
<td>45565</td>
<td>Katz</td>
<td>Comp. Sci.</td>
<td>75000</td>
</tr>
<tr class="even">
<td>58583</td>
<td>Califieri</td>
<td>History</td>
<td>62000</td>
</tr>
<tr class="odd">
<td>76543</td>
<td>Singh</td>
<td>Finance</td>
<td>80000</td>
</tr>
<tr class="even">
<td>76766</td>
<td>Crick</td>
<td>Biology</td>
<td>72000</td>
</tr>
<tr class="odd">
<td>83821</td>
<td>Brandt</td>
<td>Comp. Sci.</td>
<td>92000</td>
</tr>
<tr class="even">
<td>98345</td>
<td>Kim</td>
<td>Elec. Eng.</td>
<td>80000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-33" class="cell" data-execution_count="16">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="16">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">budget</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Biology</td>
<td>Watson</td>
<td>90000</td>
</tr>
<tr class="even">
<td>Comp. Sci.</td>
<td>Taylor</td>
<td>100000</td>
</tr>
<tr class="odd">
<td>Elec. Eng.</td>
<td>Taylor</td>
<td>85000</td>
</tr>
<tr class="even">
<td>Finance</td>
<td>Painter</td>
<td>120000</td>
</tr>
<tr class="odd">
<td>History</td>
<td>Painter</td>
<td>50000</td>
</tr>
<tr class="even">
<td>Music</td>
<td>Packard</td>
<td>80000</td>
</tr>
<tr class="odd">
<td>Physics</td>
<td>Watson</td>
<td>70000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Query:</p>
<div id="cell-35" class="cell" data-execution_count="17">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="17">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Srinivasan</td>
</tr>
<tr class="even">
<td>Wu</td>
</tr>
<tr class="odd">
<td>Einstein</td>
</tr>
<tr class="even">
<td>Gold</td>
</tr>
<tr class="odd">
<td>Katz</td>
</tr>
<tr class="even">
<td>Singh</td>
</tr>
<tr class="odd">
<td>Crick</td>
</tr>
<tr class="even">
<td>Brandt</td>
</tr>
<tr class="odd">
<td>Kim</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="string-operations" class="level2">
<h2 class="anchored" data-anchor-id="string-operations">String Operations</h2>
<div id="cell-37" class="cell" data-execution_count="19">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="19">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-101</td>
<td>Intro. to Biology</td>
<td>Biology</td>
<td>4</td>
</tr>
<tr class="even">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
</tr>
<tr class="odd">
<td>BIO-399</td>
<td>Computational Biology</td>
<td>Biology</td>
<td>3</td>
</tr>
<tr class="even">
<td>CS-101</td>
<td>Intro. to Computer Science</td>
<td>Comp. Sci.</td>
<td>4</td>
</tr>
<tr class="odd">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
</tr>
<tr class="even">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
<tr class="odd">
<td>CS-319</td>
<td>Image Processing</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
<tr class="even">
<td>CS-347</td>
<td>Database System Concepts</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
<tr class="odd">
<td>EE-181</td>
<td>Intro. to Digital Systems</td>
<td>Elec. Eng.</td>
<td>3</td>
</tr>
<tr class="even">
<td>FIN-201</td>
<td>Investment Banking</td>
<td>Finance</td>
<td>3</td>
</tr>
<tr class="odd">
<td>HIS-351</td>
<td>World History</td>
<td>History</td>
<td>3</td>
</tr>
<tr class="even">
<td>MU-199</td>
<td>Music Video Production</td>
<td>Music</td>
<td>3</td>
</tr>
<tr class="odd">
<td>PHY-101</td>
<td>Physical Principles</td>
<td>Physics</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the course <code>relation</code>, find the titles of all courses whose <code>course_id</code> has three alphabets indicating the department.</li>
</ul>
<div id="cell-39" class="cell" data-execution_count="20">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="20">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">title</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Intro. to Biology</td>
</tr>
<tr class="even">
<td>Genetics</td>
</tr>
<tr class="odd">
<td>Computational Biology</td>
</tr>
<tr class="even">
<td>Investment Banking</td>
</tr>
<tr class="odd">
<td>World History</td>
</tr>
<tr class="even">
<td>Physical Principles</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>The <code>course_id</code> of each department either has 2 or 3 alphabets in the beginning, followed by a hypher and then followed by 3 digits. The above query returns the names of all courses whose <code>course_id</code> has 3 alphabets in the beginning.</li>
</ul>
</section>
<section id="order-by" class="level2">
<h2 class="anchored" data-anchor-id="order-by">Order By</h2>
<div id="cell-42" class="cell" data-execution_count="21">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">tot_cred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>00128</td>
<td>Zhang</td>
<td>Comp. Sci.</td>
<td>102</td>
</tr>
<tr class="even">
<td>12345</td>
<td>Shankar</td>
<td>Comp. Sci.</td>
<td>32</td>
</tr>
<tr class="odd">
<td>19991</td>
<td>Brandt</td>
<td>History</td>
<td>80</td>
</tr>
<tr class="even">
<td>23121</td>
<td>Chavez</td>
<td>Finance</td>
<td>110</td>
</tr>
<tr class="odd">
<td>44553</td>
<td>Peltier</td>
<td>Physics</td>
<td>56</td>
</tr>
<tr class="even">
<td>45678</td>
<td>Levy</td>
<td>Physics</td>
<td>46</td>
</tr>
<tr class="odd">
<td>54321</td>
<td>Williams</td>
<td>Comp. Sci.</td>
<td>54</td>
</tr>
<tr class="even">
<td>55739</td>
<td>Sanchez</td>
<td>Music</td>
<td>38</td>
</tr>
<tr class="odd">
<td>70557</td>
<td>Snow</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr class="even">
<td>76543</td>
<td>Brown</td>
<td>Comp. Sci.</td>
<td>58</td>
</tr>
<tr class="odd">
<td>76653</td>
<td>Aoi</td>
<td>Elec. Eng.</td>
<td>60</td>
</tr>
<tr class="even">
<td>98765</td>
<td>Bourikas</td>
<td>Elec. Eng.</td>
<td>98</td>
</tr>
<tr class="odd">
<td>98988</td>
<td>Tanaka</td>
<td>Biology</td>
<td>120</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the student relation in the figure, obtain the list of all students in alphabetic order of departments and within each department, in decreasing order of total credits.</li>
</ul>
<div id="cell-44" class="cell" data-execution_count="22">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">tot_cred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Tanaka</td>
<td>Biology</td>
<td>120</td>
</tr>
<tr class="even">
<td>Zhang</td>
<td>Comp. Sci.</td>
<td>102</td>
</tr>
<tr class="odd">
<td>Brown</td>
<td>Comp. Sci.</td>
<td>58</td>
</tr>
<tr class="even">
<td>Williams</td>
<td>Comp. Sci.</td>
<td>54</td>
</tr>
<tr class="odd">
<td>Shankar</td>
<td>Comp. Sci.</td>
<td>32</td>
</tr>
<tr class="even">
<td>Bourikas</td>
<td>Elec. Eng.</td>
<td>98</td>
</tr>
<tr class="odd">
<td>Aoi</td>
<td>Elec. Eng.</td>
<td>60</td>
</tr>
<tr class="even">
<td>Chavez</td>
<td>Finance</td>
<td>110</td>
</tr>
<tr class="odd">
<td>Brandt</td>
<td>History</td>
<td>80</td>
</tr>
<tr class="even">
<td>Sanchez</td>
<td>Music</td>
<td>38</td>
</tr>
<tr class="odd">
<td>Peltier</td>
<td>Physics</td>
<td>56</td>
</tr>
<tr class="even">
<td>Levy</td>
<td>Physics</td>
<td>46</td>
</tr>
<tr class="odd">
<td>Snow</td>
<td>Physics</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>The list is first sorted in alphabetic order of dept name.</li>
<li>Within each dept, it is sorted in decreasing order of total credits.</li>
</ul>
</section>
<section id="in-operator" class="level2">
<h2 class="anchored" data-anchor-id="in-operator">In Operator</h2>
<div id="cell-47" class="cell" data-execution_count="23">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">sec_id</th>
<th data-quarto-table-cell-role="th">semester</th>
<th data-quarto-table-cell-role="th">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10101</td>
<td>CS-101</td>
<td>1</td>
<td>Fall</td>
<td>2017</td>
</tr>
<tr class="even">
<td>10101</td>
<td>CS-315</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="odd">
<td>10101</td>
<td>CS-347</td>
<td>1</td>
<td>Fall</td>
<td>2017</td>
</tr>
<tr class="even">
<td>12121</td>
<td>FIN-201</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="odd">
<td>15151</td>
<td>MU-199</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="even">
<td>22222</td>
<td>PHY-101</td>
<td>1</td>
<td>Fall</td>
<td>2017</td>
</tr>
<tr class="odd">
<td>32343</td>
<td>HIS-351</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="even">
<td>45565</td>
<td>CS-101</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="odd">
<td>45565</td>
<td>CS-319</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="even">
<td>76766</td>
<td>BIO-101</td>
<td>1</td>
<td>Summer</td>
<td>2017</td>
</tr>
<tr class="odd">
<td>76766</td>
<td>BIO-301</td>
<td>1</td>
<td>Summer</td>
<td>2018</td>
</tr>
<tr class="even">
<td>83821</td>
<td>CS-190</td>
<td>1</td>
<td>Spring</td>
<td>2017</td>
</tr>
<tr class="odd">
<td>83821</td>
<td>CS-190</td>
<td>2</td>
<td>Spring</td>
<td>2017</td>
</tr>
<tr class="even">
<td>83821</td>
<td>CS-319</td>
<td>2</td>
<td>Spring</td>
<td>2018</td>
</tr>
<tr class="odd">
<td>98345</td>
<td>EE-181</td>
<td>1</td>
<td>Spring</td>
<td>2017</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>teaches</code> relation, find the IDs of all courses taught in the Fall or Spring of 2018.</li>
</ul>
<div id="cell-49" class="cell" data-execution_count="24">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="24">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CS-315</td>
</tr>
<tr class="even">
<td>FIN-201</td>
</tr>
<tr class="odd">
<td>MU-199</td>
</tr>
<tr class="even">
<td>HIS-351</td>
</tr>
<tr class="odd">
<td>CS-101</td>
</tr>
<tr class="even">
<td>CS-319</td>
</tr>
<tr class="odd">
<td>CS-319</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Note: We can use <code>distinct</code> to remove duplicates.</li>
</ul>
<div id="cell-51" class="cell" data-execution_count="25">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="25">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CS-315</td>
</tr>
<tr class="even">
<td>FIN-201</td>
</tr>
<tr class="odd">
<td>MU-199</td>
</tr>
<tr class="even">
<td>HIS-351</td>
</tr>
<tr class="odd">
<td>CS-101</td>
</tr>
<tr class="even">
<td>CS-319</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="set-operations-union" class="level1">
<h1>Set Operations: union</h1>
<ul>
<li>For the same question as above, find the solution using the <code>union</code> operator.</li>
</ul>
<div id="cell-53" class="cell" data-execution_count="26">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CS-101</td>
</tr>
<tr class="even">
<td>CS-315</td>
</tr>
<tr class="odd">
<td>CS-319</td>
</tr>
<tr class="even">
<td>FIN-201</td>
</tr>
<tr class="odd">
<td>HIS-351</td>
</tr>
<tr class="even">
<td>MU-199</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Note that <code>union</code> removes all duplicates. If we use <code>union all</code> instead of <code>union</code>, we get the same set of tuples but with duplicates.</li>
</ul>
<section id="set-operations-2-intersect" class="level2">
<h2 class="anchored" data-anchor-id="set-operations-2-intersect">Set Operations (2): intersect</h2>
<div id="cell-56" class="cell" data-execution_count="27">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10101</td>
<td>Srinivasan</td>
<td>Comp. Sci.</td>
<td>65000</td>
</tr>
<tr class="even">
<td>12121</td>
<td>Wu</td>
<td>Finance</td>
<td>90000</td>
</tr>
<tr class="odd">
<td>15151</td>
<td>Mozart</td>
<td>Music</td>
<td>40000</td>
</tr>
<tr class="even">
<td>22222</td>
<td>Einstein</td>
<td>Physics</td>
<td>95000</td>
</tr>
<tr class="odd">
<td>32343</td>
<td>El Said</td>
<td>History</td>
<td>60000</td>
</tr>
<tr class="even">
<td>33456</td>
<td>Gold</td>
<td>Physics</td>
<td>87000</td>
</tr>
<tr class="odd">
<td>45565</td>
<td>Katz</td>
<td>Comp. Sci.</td>
<td>75000</td>
</tr>
<tr class="even">
<td>58583</td>
<td>Califieri</td>
<td>History</td>
<td>62000</td>
</tr>
<tr class="odd">
<td>76543</td>
<td>Singh</td>
<td>Finance</td>
<td>80000</td>
</tr>
<tr class="even">
<td>76766</td>
<td>Crick</td>
<td>Biology</td>
<td>72000</td>
</tr>
<tr class="odd">
<td>83821</td>
<td>Brandt</td>
<td>Comp. Sci.</td>
<td>92000</td>
</tr>
<tr class="even">
<td>98345</td>
<td>Kim</td>
<td>Elec. Eng.</td>
<td>80000</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>instructor</code> relation, find the names of all instructors who taught in either the Computer Science department or the Finance department and whose salary is &lt; 80000.</li>
</ul>
<div id="cell-58" class="cell" data-execution_count="30">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="30">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Katz</td>
</tr>
<tr class="even">
<td>Srinivasan</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-59" class="cell" data-execution_count="31">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="31">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Srinivasan</td>
</tr>
<tr class="even">
<td>Katz</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="set-operations-3-except" class="level2">
<h2 class="anchored" data-anchor-id="set-operations-3-except">Set Operations (3): except</h2>
<ul>
<li>From the <code>instructor</code> relation, find the names of all instructors who taught in the Computer Science department or the Finance department and whose salary is either &gt;= 90000 or &lt;= 70000.</li>
</ul>
<div id="cell-61" class="cell" data-execution_count="32">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="32">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Brandt</td>
</tr>
<tr class="even">
<td>Srinivasan</td>
</tr>
<tr class="odd">
<td>Wu</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-62" class="cell" data-execution_count="33">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="33">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Srinivasan</td>
</tr>
<tr class="even">
<td>Wu</td>
</tr>
<tr class="odd">
<td>Brandt</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aggregate-functions-avg" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-functions-avg">Aggregate functions: avg</h2>
<div id="cell-64" class="cell" data-execution_count="34">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="34">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">room_number</th>
<th data-quarto-table-cell-role="th">capacity</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packard</td>
<td>101</td>
<td>500</td>
</tr>
<tr class="even">
<td>Painter</td>
<td>514</td>
<td>10</td>
</tr>
<tr class="odd">
<td>Taylor</td>
<td>3128</td>
<td>70</td>
</tr>
<tr class="even">
<td>Watson</td>
<td>100</td>
<td>30</td>
</tr>
<tr class="odd">
<td>Watson</td>
<td>120</td>
<td>50</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>classroom</code> relation, find the names and the average capacity of each building whose average capacity is greater than 25.</li>
</ul>
<div id="cell-66" class="cell" data-execution_count="35">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">AVG(capacity)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packard</td>
<td>500.0</td>
</tr>
<tr class="even">
<td>Taylor</td>
<td>70.0</td>
</tr>
<tr class="odd">
<td>Watson</td>
<td>40.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aggregate-functions-2-min" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-functions-2-min">Aggregate functions (2): min</h2>
<div id="cell-68" class="cell" data-execution_count="36">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="36">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10101</td>
<td>Srinivasan</td>
<td>Comp. Sci.</td>
<td>65000</td>
</tr>
<tr class="even">
<td>12121</td>
<td>Wu</td>
<td>Finance</td>
<td>90000</td>
</tr>
<tr class="odd">
<td>15151</td>
<td>Mozart</td>
<td>Music</td>
<td>40000</td>
</tr>
<tr class="even">
<td>22222</td>
<td>Einstein</td>
<td>Physics</td>
<td>95000</td>
</tr>
<tr class="odd">
<td>32343</td>
<td>El Said</td>
<td>History</td>
<td>60000</td>
</tr>
<tr class="even">
<td>33456</td>
<td>Gold</td>
<td>Physics</td>
<td>87000</td>
</tr>
<tr class="odd">
<td>45565</td>
<td>Katz</td>
<td>Comp. Sci.</td>
<td>75000</td>
</tr>
<tr class="even">
<td>58583</td>
<td>Califieri</td>
<td>History</td>
<td>62000</td>
</tr>
<tr class="odd">
<td>76543</td>
<td>Singh</td>
<td>Finance</td>
<td>80000</td>
</tr>
<tr class="even">
<td>76766</td>
<td>Crick</td>
<td>Biology</td>
<td>72000</td>
</tr>
<tr class="odd">
<td>83821</td>
<td>Brandt</td>
<td>Comp. Sci.</td>
<td>92000</td>
</tr>
<tr class="even">
<td>98345</td>
<td>Kim</td>
<td>Elec. Eng.</td>
<td>80000</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>instructor</code> relation, find the least salary drawn by any instructor among all the instructors.</li>
</ul>
<div id="cell-70" class="cell" data-execution_count="37">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="37">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">least_salary</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>40000</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aggregate-functions-3-max" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-functions-3-max">Aggregate functions (3): max</h2>
<div id="cell-72" class="cell" data-execution_count="38">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="38">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">ID</th>
<th data-quarto-table-cell-role="th">name</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">tot_cred</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>00128</td>
<td>Zhang</td>
<td>Comp. Sci.</td>
<td>102</td>
</tr>
<tr class="even">
<td>12345</td>
<td>Shankar</td>
<td>Comp. Sci.</td>
<td>32</td>
</tr>
<tr class="odd">
<td>19991</td>
<td>Brandt</td>
<td>History</td>
<td>80</td>
</tr>
<tr class="even">
<td>23121</td>
<td>Chavez</td>
<td>Finance</td>
<td>110</td>
</tr>
<tr class="odd">
<td>44553</td>
<td>Peltier</td>
<td>Physics</td>
<td>56</td>
</tr>
<tr class="even">
<td>45678</td>
<td>Levy</td>
<td>Physics</td>
<td>46</td>
</tr>
<tr class="odd">
<td>54321</td>
<td>Williams</td>
<td>Comp. Sci.</td>
<td>54</td>
</tr>
<tr class="even">
<td>55739</td>
<td>Sanchez</td>
<td>Music</td>
<td>38</td>
</tr>
<tr class="odd">
<td>70557</td>
<td>Snow</td>
<td>Physics</td>
<td>0</td>
</tr>
<tr class="even">
<td>76543</td>
<td>Brown</td>
<td>Comp. Sci.</td>
<td>58</td>
</tr>
<tr class="odd">
<td>76653</td>
<td>Aoi</td>
<td>Elec. Eng.</td>
<td>60</td>
</tr>
<tr class="even">
<td>98765</td>
<td>Bourikas</td>
<td>Elec. Eng.</td>
<td>98</td>
</tr>
<tr class="odd">
<td>98988</td>
<td>Tanaka</td>
<td>Biology</td>
<td>120</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>student</code> relation, find the maximum credits obtained by any student among all the students.</li>
</ul>
<div id="cell-74" class="cell" data-execution_count="39">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="39">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">max_credits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>120</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aggregate-functions-4-count" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-functions-4-count">Aggregate functions (4): count</h2>
<div id="cell-76" class="cell" data-execution_count="40">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">sec_id</th>
<th data-quarto-table-cell-role="th">semester</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">room_number</th>
<th data-quarto-table-cell-role="th">time_slot_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-101</td>
<td>1</td>
<td>Summer</td>
<td>2017</td>
<td>Painter</td>
<td>514</td>
<td>B</td>
</tr>
<tr class="even">
<td>BIO-301</td>
<td>1</td>
<td>Summer</td>
<td>2018</td>
<td>Painter</td>
<td>514</td>
<td>A</td>
</tr>
<tr class="odd">
<td>CS-101</td>
<td>1</td>
<td>Fall</td>
<td>2017</td>
<td>Packard</td>
<td>101</td>
<td>H</td>
</tr>
<tr class="even">
<td>CS-101</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
<td>Packard</td>
<td>101</td>
<td>F</td>
</tr>
<tr class="odd">
<td>CS-190</td>
<td>1</td>
<td>Spring</td>
<td>2017</td>
<td>Taylor</td>
<td>3128</td>
<td>E</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>2</td>
<td>Spring</td>
<td>2017</td>
<td>Taylor</td>
<td>3128</td>
<td>A</td>
</tr>
<tr class="odd">
<td>CS-315</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
<td>Watson</td>
<td>120</td>
<td>D</td>
</tr>
<tr class="even">
<td>CS-319</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
<td>Watson</td>
<td>100</td>
<td>B</td>
</tr>
<tr class="odd">
<td>CS-319</td>
<td>2</td>
<td>Spring</td>
<td>2018</td>
<td>Taylor</td>
<td>3128</td>
<td>C</td>
</tr>
<tr class="even">
<td>CS-347</td>
<td>1</td>
<td>Fall</td>
<td>2017</td>
<td>Taylor</td>
<td>3128</td>
<td>A</td>
</tr>
<tr class="odd">
<td>EE-181</td>
<td>1</td>
<td>Spring</td>
<td>2017</td>
<td>Taylor</td>
<td>3128</td>
<td>C</td>
</tr>
<tr class="even">
<td>FIN-201</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
<td>Packard</td>
<td>101</td>
<td>B</td>
</tr>
<tr class="odd">
<td>HIS-351</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
<td>Painter</td>
<td>514</td>
<td>C</td>
</tr>
<tr class="even">
<td>MU-199</td>
<td>1</td>
<td>Spring</td>
<td>2018</td>
<td>Packard</td>
<td>101</td>
<td>D</td>
</tr>
<tr class="odd">
<td>PHY-101</td>
<td>1</td>
<td>Fall</td>
<td>2017</td>
<td>Watson</td>
<td>100</td>
<td>A</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>section</code> relation, find the number of courses run in each building.</li>
</ul>
<div id="cell-78" class="cell" data-execution_count="42">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">building</th>
<th data-quarto-table-cell-role="th">course_count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Packard</td>
<td>4</td>
</tr>
<tr class="even">
<td>Painter</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Taylor</td>
<td>5</td>
</tr>
<tr class="even">
<td>Watson</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="aggregate-functions-5-sum" class="level2">
<h2 class="anchored" data-anchor-id="aggregate-functions-5-sum">Aggregate functions (5): sum</h2>
<div id="cell-80" class="cell" data-execution_count="43">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-101</td>
<td>Intro. to Biology</td>
<td>Biology</td>
<td>4</td>
</tr>
<tr class="even">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
</tr>
<tr class="odd">
<td>BIO-399</td>
<td>Computational Biology</td>
<td>Biology</td>
<td>3</td>
</tr>
<tr class="even">
<td>CS-101</td>
<td>Intro. to Computer Science</td>
<td>Comp. Sci.</td>
<td>4</td>
</tr>
<tr class="odd">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
</tr>
<tr class="even">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
<tr class="odd">
<td>CS-319</td>
<td>Image Processing</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
<tr class="even">
<td>CS-347</td>
<td>Database System Concepts</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
<tr class="odd">
<td>EE-181</td>
<td>Intro. to Digital Systems</td>
<td>Elec. Eng.</td>
<td>3</td>
</tr>
<tr class="even">
<td>FIN-201</td>
<td>Investment Banking</td>
<td>Finance</td>
<td>3</td>
</tr>
<tr class="odd">
<td>HIS-351</td>
<td>World History</td>
<td>History</td>
<td>3</td>
</tr>
<tr class="even">
<td>MU-199</td>
<td>Music Video Production</td>
<td>Music</td>
<td>3</td>
</tr>
<tr class="odd">
<td>PHY-101</td>
<td>Physical Principles</td>
<td>Physics</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>From the <code>course</code> relation, find the total credits offered by each department.</li>
</ul>
<div id="cell-82" class="cell" data-execution_count="44">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">sum_credits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Biology</td>
<td>11</td>
</tr>
<tr class="even">
<td>Comp. Sci.</td>
<td>17</td>
</tr>
<tr class="odd">
<td>Elec. Eng.</td>
<td>3</td>
</tr>
<tr class="even">
<td>Finance</td>
<td>3</td>
</tr>
<tr class="odd">
<td>History</td>
<td>3</td>
</tr>
<tr class="even">
<td>Music</td>
<td>3</td>
</tr>
<tr class="odd">
<td>Physics</td>
<td>4</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="lecture-3.2-intermediate-sql1" class="level1">
<h1>Lecture 3.2: Intermediate SQL/1</h1>
<section id="nested-subqueries" class="level2">
<h2 class="anchored" data-anchor-id="nested-subqueries">Nested Subqueries</h2>
<ul>
<li>SQL provides a mechanism for nesting of subqueries</li>
<li>A <strong>subquery</strong> is a <strong>select-from-where</strong> expression that is nested within another query</li>
<li>The nesting can be done in the following SQL query <span class="math display"> \text{select } A_1, A_2, ..., A_n </span> <span class="math display"> \text{from } r_1, r_2, ..., r_m </span> <span class="math display"> \text{where } P </span> as follows:
<ul>
<li><p><span class="math inline">A_i</span> can be a subquery that generates a single value</p></li>
<li><p><span class="math inline">r_i</span> can be replaced by any valid subquery</p></li>
<li><p><span class="math inline">P</span> can be replaced with an expressionm of the form:</p>
<p><span class="math inline">B \text{ &lt;operation&gt;}</span> (subquery)</p>
<p>where <span class="math inline">B</span> is an attribute and <span class="math inline">\text{&lt;operation&gt;}</span> to be defined later.</p></li>
</ul></li>
</ul>
</section>
<section id="subqueries-in-the-where-clause" class="level2">
<h2 class="anchored" data-anchor-id="subqueries-in-the-where-clause">Subqueries in the Where Clause</h2>
<ul>
<li>Typical use of subqueries is to perform tests:
<ul>
<li>For set membership</li>
<li>For set comparisons</li>
<li>For set cardinality</li>
</ul></li>
</ul>
</section>
<section id="set-membership" class="level2">
<h2 class="anchored" data-anchor-id="set-membership">Set Membership</h2>
<ul>
<li>Find courses offered in Fall 2009 and in Spring 2010 (<strong>intersect</strong> example)</li>
</ul>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">distinct</span> course_id</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> section</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> semester <span class="op">=</span> <span class="st">'Fall'</span> <span class="kw">and</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2017</span> <span class="kw">and</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>course_id <span class="kw">in</span> (<span class="kw">select</span> course_id</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>              <span class="kw">from</span> section</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>              <span class="kw">where</span> semester <span class="op">=</span> <span class="st">'Spring'</span> <span class="kw">and</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2018</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="cell-88" class="cell" data-execution_count="14">
<div class="cell-output cell-output-stdout">
<pre><code>CS-101</code></pre>
</div>
</div>
<ul>
<li>Find courses offered in Fall 2009 but not in Spring 2010 (<strong>except</strong> example)</li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">distinct</span> course_id</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> section</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> semester <span class="op">=</span> <span class="st">'Fall'</span> <span class="kw">and</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2017</span> <span class="kw">and</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>course_id <span class="kw">not</span> <span class="kw">in</span> (<span class="kw">select</span> course_id</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>              <span class="kw">from</span> section</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>              <span class="kw">where</span> semester <span class="op">=</span> <span class="st">'Spring'</span> <span class="kw">and</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2018</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="cell-90" class="cell" data-execution_count="13">
<div class="cell-output cell-output-stdout">
<pre><code>CS-347
PHY-101</code></pre>
</div>
</div>
<div id="cell-91" class="cell" data-execution_count="27">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="27">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>CS-347</td>
</tr>
<tr class="even">
<td>PHY-101</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="set-membership-2" class="level2">
<h2 class="anchored" data-anchor-id="set-membership-2">Set Membership (2)</h2>
<ul>
<li>Find the total number of (distinct) students who have taken course sections taught by instructor with ID ‘10101’</li>
</ul>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="fu">count</span>(<span class="kw">distinct</span> <span class="kw">ID</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> takes</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> (course_id, sec_id, semester, <span class="dt">year</span>) <span class="kw">in</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">select</span> course_id, sec_id, semester, <span class="dt">year</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> teaches</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> teaches.<span class="kw">ID</span> <span class="op">=</span> <span class="st">'10101'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="cell-93" class="cell" data-execution_count="21">
<div class="cell-output cell-output-stdout">
<pre><code>6</code></pre>
</div>
</div>
<div id="cell-94" class="cell" data-execution_count="26">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="26">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count(distinct ID)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-95" class="cell" data-execution_count="28">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
</div>
<div id="cell-96" class="cell" data-execution_count="29">
<div class="cell-output cell-output-display" data-execution_count="29">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">count(distinct ID)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>6</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="set-comparison---some-clause" class="level2">
<h2 class="anchored" data-anchor-id="set-comparison---some-clause">Set Comparison - “some” Clause</h2>
<ul>
<li>Find the names of instructors with salary greater than that of some (at least one) instructor in the Biology department</li>
</ul>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">distinct</span> T.name</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> instructor T, instructor S</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> T.salary <span class="op">&gt;</span> S.salary <span class="kw">and</span> S.dept_name <span class="op">=</span> <span class="st">'Biology'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Same query using <strong>some</strong> clause</li>
</ul>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> name</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> instructor</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> salary <span class="op">&gt;</span> <span class="kw">some</span> (<span class="kw">select</span> salary</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">from</span> instructor</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">where</span> dept_name <span class="op">=</span> <span class="st">'Biology'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definition-of-some-clause" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-some-clause">Definition of “some” Clause</h2>
<ul>
<li>F <span class="math inline">\text{&lt;comp&gt;}</span> <strong>some</strong> <span class="math inline">r \Leftrightarrow \exists t \in r</span> such that (F <span class="math inline">\text{&lt;comp&gt;}</span> t) where <span class="math inline">\text{&lt;comp&gt;}</span> can be: <span class="math inline">&lt;</span>, <span class="math inline">\leq</span>, <span class="math inline">&gt;</span>, <span class="math inline">\geq</span>, <span class="math inline">=</span>, <span class="math inline">\neq</span></li>
<li><strong>some</strong> represents existential quantification</li>
</ul>
<p>(5 &lt; <strong>some</strong> {0, 5, 6}) = True</p>
<p>(5 &lt; <strong>some</strong> {0, 5}) = False</p>
<p>(5 = <strong>some</strong> {0, 5}) = True</p>
<p>(5 <span class="math inline">\neq</span> <strong>some</strong> {0, 5}) = False</p>
<p>(= <strong>some</strong>) <span class="math inline">\equiv</span> <strong>in</strong></p>
<p>However, (<span class="math inline">\neq</span> <strong>some</strong>) <span class="math inline">\equiv</span> <strong>not in</strong></p>
</section>
<section id="set-comparison---all-clause" class="level2">
<h2 class="anchored" data-anchor-id="set-comparison---all-clause">Set Comparison - “all” Clause</h2>
<ul>
<li>Find the names of all instructors with salary greater than that of all instructors in the Biology department</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> name</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> instructor</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> salary <span class="op">&gt;</span> <span class="kw">all</span> (<span class="kw">select</span> salary</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">from</span> instructor</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">where</span> dept_name <span class="op">=</span> <span class="st">'Biology'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="definition-of-all-clause" class="level2">
<h2 class="anchored" data-anchor-id="definition-of-all-clause">Definition of “all” Clause</h2>
<ul>
<li>F <span class="math inline">\text{&lt;comp&gt;}</span> <strong>all</strong> <span class="math inline">r \Leftrightarrow \forall t \in r</span> such that (F <span class="math inline">\text{&lt;comp&gt;}</span> t) where <span class="math inline">\text{&lt;comp&gt;}</span> can be: <span class="math inline">&lt;</span>, <span class="math inline">\leq</span>, <span class="math inline">&gt;</span>, <span class="math inline">\geq</span>, <span class="math inline">=</span>, <span class="math inline">\neq</span></li>
<li><strong>all</strong> represents universal quantification</li>
</ul>
<p>(5 &lt; <strong>all</strong> {0, 5, 6}) = False</p>
<p>(5 &lt; <strong>all</strong> {6, 10}) = True</p>
<p>(5 = <strong>all</strong> {0, 5}) = False</p>
<p>(5 <span class="math inline">\neq</span> <strong>all</strong> {4, 6}) = True</p>
<p>(<span class="math inline">\neq</span> <strong>all</strong>) <span class="math inline">\equiv</span> <strong>not in</strong></p>
<p>However, (<span class="math inline">=</span> <strong>all</strong>) !<span class="math inline">\equiv</span> <strong>in</strong></p>
</section>
<section id="test-for-empty-relations-exists" class="level2">
<h2 class="anchored" data-anchor-id="test-for-empty-relations-exists">Test for Empty Relations: “exists”</h2>
<ul>
<li>The <strong>exists</strong> constucrt returns the value <strong>true</strong> if the argument subquery is non-empty
<ul>
<li><strong>exists</strong> $r r $</li>
<li><strong>not exists</strong> $r r = $</li>
</ul></li>
</ul>
</section>
<section id="use-of-exists-clause" class="level2">
<h2 class="anchored" data-anchor-id="use-of-exists-clause">Use of “exists” clause</h2>
<ul>
<li>Yet another way of specifying the query “Find all courses taught in both the Fall 2009 semester and in the Spring 2010 semester”</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> course_id</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> section <span class="kw">as</span> S</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> semester <span class="op">=</span> <span class="st">'Fall'</span> <span class="kw">and</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2009</span> <span class="kw">and</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="kw">exists</span> (<span class="kw">select</span> <span class="op">*</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> section <span class="kw">as</span> T</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">where</span> semester <span class="op">=</span> <span class="st">'Spring'</span> <span class="kw">and</span> <span class="dt">year</span> <span class="op">=</span> <span class="dv">2010</span> <span class="kw">and</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>        S.course_id <span class="op">=</span> T.course_id);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><strong>Correlation name</strong> - variable S in the outer query</li>
<li><strong>Correlated subquery</strong> - subquery that references the correlation name (the inner query)</li>
</ul>
</section>
<section id="use-of-not-exists-clause" class="level2">
<h2 class="anchored" data-anchor-id="use-of-not-exists-clause">Use of “not exists” clause</h2>
<ul>
<li>Find all students who have taken all courses offered in the Biology department.</li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">distinct</span> S.<span class="kw">ID</span>, S.name</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> student <span class="kw">as</span> S</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> <span class="kw">not</span> <span class="kw">exists</span> ((<span class="kw">select</span> course_id</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">from</span> course</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">where</span> dept_name <span class="op">=</span> <span class="st">'Biology'</span>)</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">except</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>                    (<span class="kw">select</span> T.course_id</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">from</span> takes <span class="kw">as</span> T</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">where</span> S.<span class="kw">ID</span> <span class="op">=</span> T.<span class="kw">ID</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><p>First nested query lists all courses offered in Biology</p></li>
<li><p>Second nested query lists all courses a particular student took</p></li>
<li><p>Note: <span class="math inline">X-Y = \emptyset \Leftrightarrow X \subseteq Y</span></p></li>
<li><p>Note: Cannot write this query using <span class="math inline">=</span> <strong>all</strong> and its variants</p></li>
</ul>
</section>
<section id="test-for-absence-of-duplicate-tuples-unique" class="level2">
<h2 class="anchored" data-anchor-id="test-for-absence-of-duplicate-tuples-unique">Test for Absence of Duplicate Tuples: “unique”</h2>
<ul>
<li>The <strong>unique</strong> construct tests whether a subquery has any duplicate tuples in its result</li>
<li>The <strong>unique</strong> construct evaluates to <strong>true</strong> if the subquery result has no duplicate tuples</li>
<li>Find all courses that were offered at most once in 2009</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> T.course_id</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> course <span class="kw">as</span> T</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> <span class="kw">unique</span> (<span class="kw">select</span> R.course_id</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>              <span class="kw">from</span> section <span class="kw">as</span> R</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>              <span class="kw">where</span> R.course_id <span class="op">=</span> T.course_id</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>              <span class="kw">and</span> R.<span class="dt">year</span> <span class="op">=</span> <span class="dv">2009</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="subqueries-in-the-from-clause" class="level2">
<h2 class="anchored" data-anchor-id="subqueries-in-the-from-clause">Subqueries in the From Clause</h2>
<ul>
<li>SQL allows a subquery expression to be used in the <strong>from</strong> clause</li>
<li>Find the average instructors’ salaries of those departments where the average salary is greater than $42,000</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> dept_name, avg_salary</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> (<span class="kw">select</span> dept_name, <span class="fu">avg</span>(salary) <span class="kw">as</span> avg_salary</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">from</span> instructor</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">group</span> <span class="kw">by</span> dept_name)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> avg_salary <span class="op">&gt;</span> <span class="dv">42000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Note that we do not need to use the <strong>having</strong> clause</li>
<li>Another way to write the same query is:</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> dept_name, avg_salary</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> (<span class="kw">select</span> dept_name, <span class="fu">avg</span>(salary)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">from</span> instructor</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">group</span> <span class="kw">by</span> dept_name) <span class="kw">as</span> dept_avg (dept_name, avg_salary)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> avg_salary <span class="op">&gt;</span> <span class="dv">42000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="with-clause" class="level2">
<h2 class="anchored" data-anchor-id="with-clause">With Clause</h2>
<ul>
<li>The <strong>with</strong> clause provides a way of defining a temporary relation whose definition is available only to the query in which the with clause occurs</li>
<li>Find all departments with the maximum budget</li>
</ul>
<div class="sourceCode" id="cb55"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="kw">with</span> max_budget(<span class="fu">value</span>) <span class="kw">as</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">select</span> <span class="fu">max</span>(budget)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> department)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> department.dept_name</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> department, max_budget</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> department.budget <span class="op">=</span> max_budget.<span class="fu">value</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="complex-queries-using-with-clause" class="level2">
<h2 class="anchored" data-anchor-id="complex-queries-using-with-clause">Complex Queries using With Clause</h2>
<ul>
<li>Find all departments where the total salary is greater than the average of the total salary at all departments</li>
</ul>
<div class="sourceCode" id="cb56"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="kw">with</span> dept_total(dept_name, <span class="fu">value</span>) <span class="kw">as</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> dept_name, <span class="fu">sum</span>(salary)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> instructor</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">group</span> <span class="kw">by</span> dept_name,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>dept_total_avg(<span class="fu">value</span>) <span class="kw">as</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">select</span> <span class="fu">avg</span>(<span class="fu">value</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> dept_total)</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> dept_name</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> dept_total, dept_total_avg</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> dept_total.<span class="fu">value</span> <span class="op">&gt;</span> dept_total_avg.<span class="fu">value</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="scalar-subquery" class="level2">
<h2 class="anchored" data-anchor-id="scalar-subquery">Scalar Subquery</h2>
<ul>
<li>A <strong>scalar subquery</strong> is a subquery that returns a single value</li>
<li>List all departments along with the number of instructors in each department</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> dept_name,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">select</span> <span class="fu">count</span>(<span class="op">*</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> instructor</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> instructor.dept_name <span class="op">=</span> department.dept_name)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> num_instructors</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> department;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Runtime error if the subquery returns more than one result tuple</li>
</ul>
</section>
<section id="modification-of-the-database" class="level2">
<h2 class="anchored" data-anchor-id="modification-of-the-database">Modification of the Database</h2>
<ul>
<li>Deletion of tuples from a given relation</li>
<li>Insertion of new tuples into a given relation</li>
<li>Updating of values in some tuples in a given relation</li>
</ul>
</section>
<section id="deletion" class="level2">
<h2 class="anchored" data-anchor-id="deletion">Deletion</h2>
<ul>
<li><p>Delete all instructors</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="kw">delete</span> <span class="kw">from</span> instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete all instructors from the Finance department</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="kw">delete</span> <span class="kw">from</span> instructor</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> dept_name <span class="op">=</span> <span class="st">'Finance'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete all tuples in the instructor relation for those instructors associated with a department located in the Watson building</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="kw">delete</span> <span class="kw">from</span> instructor</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> dept_name <span class="kw">in</span> (<span class="kw">select</span> dept_name</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">from</span> department</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">where</span> building <span class="op">=</span> <span class="st">'Watson'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Delete all instructors whose salary is less than the average of all instructors’ salaries</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="kw">delete</span> <span class="kw">from</span> instructor</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="kw">where</span> salary <span class="op">&lt;</span> (<span class="kw">select</span> <span class="fu">avg</span>(salary)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                <span class="kw">from</span> instructor);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Problem</strong>: as we delete tuples, the average salary changes</p></li>
<li><p><strong>Solution</strong> used in SQL:</p>
<ul>
<li>First compute <strong>avg</strong>(salary) and find all tuples to be deleted</li>
<li>Next, delete all tuples found above (without recomputing <strong>avg</strong> or retesting the tuples)</li>
</ul></li>
</ul>
</section>
<section id="insertion" class="level2">
<h2 class="anchored" data-anchor-id="insertion">Insertion</h2>
<ul>
<li><p>Add a new typle to course</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> course</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="kw">values</span> (<span class="st">'CS-437'</span>, <span class="st">'Database Systems'</span>, <span class="st">'Comp. Sci.'</span>, <span class="dv">4</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>or equivalently</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> course (course_id, title, dept_name, credits)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">values</span> (<span class="st">'CS-437'</span>, <span class="st">'Database Systems'</span>, <span class="st">'Comp. Sci.'</span>, <span class="dv">4</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Add a new tuple to student with tot_creds set to null</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> student</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="kw">values</span> (<span class="st">'3003'</span>, <span class="st">'Green'</span>, <span class="st">'Finance'</span>, <span class="kw">null</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Add all instructors to the student relation with tot_creds set to 0</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> student</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">ID</span>, name, dept_name, <span class="dv">0</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The <strong>select-from-where</strong> statement is evaluated fully before any of its results are inserted into the relation</p></li>
<li><p>Otherwise queries like</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">insert</span> <span class="kw">into</span> table1 <span class="kw">select</span> <span class="op">*</span> <span class="kw">from</span> table1;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>would result in an infinite loop</p></li>
</ul>
</section>
<section id="updates" class="level2">
<h2 class="anchored" data-anchor-id="updates">Updates</h2>
<ul>
<li>Increase the salary of all instructors whose salary is over $100,00 by 3% and all others by 5%
<ul>
<li><p>With two <strong>update</strong> statements</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> instructor</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> salary <span class="op">=</span> salary <span class="op">*</span> <span class="fl">1.03</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> salary <span class="op">&gt;</span> <span class="dv">100000</span>;</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> instructor</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> salary <span class="op">=</span> salary <span class="op">*</span> <span class="fl">1.05</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> salary <span class="op">&lt;=</span> <span class="dv">100000</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li>The order is important</li>
<li>Can be done better using the <strong>case</strong> statement</li>
</ul>
</section>
<section id="case-statement-for-conditional-updates" class="level2">
<h2 class="anchored" data-anchor-id="case-statement-for-conditional-updates">Case Statement for Conditional Updates</h2>
<ul>
<li><p>Same query as above using the <strong>case</strong> statement</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> instructor</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">set</span> salary <span class="op">=</span> <span class="cf">case</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>                <span class="cf">when</span> salary <span class="op">&lt;=</span> <span class="dv">100000</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>                <span class="cf">then</span> salary <span class="op">*</span> <span class="fl">1.05</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span> salary <span class="op">*</span> <span class="fl">1.03</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="updates-with-scalar-subqueries" class="level2">
<h2 class="anchored" data-anchor-id="updates-with-scalar-subqueries">Updates with Scalar Subqueries</h2>
<ul>
<li><p>Recompute and update tot_creds value for all students</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">update</span> student</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> tot_creds <span class="op">=</span> (<span class="kw">select</span> <span class="fu">sum</span>(credits)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                <span class="kw">from</span> takes, course</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                <span class="kw">where</span> takes.course_id <span class="op">=</span> course.course_id <span class="kw">and</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>                S.<span class="kw">ID</span> <span class="op">=</span> takes.<span class="kw">ID</span> <span class="kw">and</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                takes.grade <span class="op">&lt;&gt;</span> <span class="st">'F'</span> <span class="kw">and</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>                takes.grade <span class="kw">is</span> <span class="kw">not</span> <span class="kw">null</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Set tot_creds to null for all students who have not taken any courses</p></li>
<li><p>Instead of <strong>sum</strong>(credits), use:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">when</span> <span class="fu">sum</span>(credits) <span class="kw">is</span> <span class="kw">not</span> <span class="kw">null</span> <span class="cf">then</span> <span class="fu">sum</span>(credits)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
</section>
<section id="lecture-3.3-intermediate-sql2" class="level1">
<h1>Lecture 3.3: Intermediate SQL/2</h1>
<section id="join-relations" class="level2">
<h2 class="anchored" data-anchor-id="join-relations">Join Relations</h2>
<ul>
<li><strong>Join operations</strong> take two relations and return as result another relation</li>
<li>A join operation is a Cartesian product which requires that tuples in the two relations match (under some condition)</li>
<li>It also specifies the attributes that are present in the result of the join</li>
<li>The join operations are typically used as subquery expressions in the <strong>from</strong> clause</li>
</ul>
</section>
<section id="types-of-joins-between-relations" class="level2">
<h2 class="anchored" data-anchor-id="types-of-joins-between-relations">Types of Joins between Relations</h2>
<ul>
<li>Cross join</li>
<li>Inner join
<ul>
<li>Equi-join
<ul>
<li>Natural join</li>
</ul></li>
</ul></li>
<li>Outer join
<ul>
<li>Left outer join</li>
<li>Right outer join</li>
<li>Full outer join</li>
</ul></li>
<li>Self-join</li>
</ul>
</section>
<section id="cross-join" class="level2">
<h2 class="anchored" data-anchor-id="cross-join">Cross Join</h2>
<ul>
<li>CROSS JOIN returns the Cartesian product of rows from tables in the join
<ul>
<li><p>Explicit</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> employee <span class="kw">cross</span> <span class="kw">join</span> department;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Implicit</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="op">*</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> employee, department;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
</ul>
</section>
<section id="join-operations---example" class="level2">
<h2 class="anchored" data-anchor-id="join-operations---example">Join Operations - Example</h2>
<ul>
<li>Relation course</li>
</ul>
<div id="cell-127" class="cell" data-execution_count="30">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
</div>
<div id="cell-128" class="cell" data-execution_count="31">
<div class="cell-output cell-output-display" data-execution_count="31">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
</tr>
<tr class="odd">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="cell-129" class="cell" data-execution_count="34">
<div class="cell-output cell-output-stdout">
<pre><code> * sqlite:///univdb-sqlite.db
Done.</code></pre>
</div>
</div>
<ul>
<li>Relation prereq</li>
</ul>
<div id="cell-131" class="cell" data-execution_count="35">
<div class="cell-output cell-output-display" data-execution_count="35">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>CS-347</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>Observe that
<ul>
<li>prereq information is missing for course CS-315, and</li>
<li>course information is missing for CS-347</li>
</ul></li>
</ul>
</section>
<section id="inner-join" class="level2">
<h2 class="anchored" data-anchor-id="inner-join">Inner Join</h2>
<ul>
<li>course <strong>inner join</strong> prereq</li>
</ul>
<div id="cell-135" class="cell" data-execution_count="41">
<div class="cell-output cell-output-display" data-execution_count="41">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">course_id_1</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-190</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>If specified as <strong>natural</strong>, the join is on all attributes with the same name</li>
</ul>
<div id="cell-138" class="cell" data-execution_count="43">
<div class="cell-output cell-output-display" data-execution_count="43">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="outer-join" class="level2">
<h2 class="anchored" data-anchor-id="outer-join">Outer Join</h2>
<ul>
<li>An extension of the join operation that avoids loss of information</li>
<li>Computes the join and then adds tuples from one relation that does not match tuples in the other relation to the result of the join</li>
<li>Uses <em>null</em> values, which is None in Python</li>
</ul>
</section>
<section id="left-outer-join" class="level2">
<h2 class="anchored" data-anchor-id="left-outer-join">Left Outer Join</h2>
<ul>
<li>course <strong>left outer join</strong> prereq</li>
</ul>
<div id="cell-142" class="cell" data-execution_count="45">
<div class="cell-output cell-output-display" data-execution_count="45">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">course_id_1</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-190</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="right-outer-join" class="level2">
<h2 class="anchored" data-anchor-id="right-outer-join">Right Outer Join</h2>
<ul>
<li>course <strong>right outer join</strong> prereq</li>
</ul>
<div id="cell-145" class="cell" data-execution_count="47">
<div class="cell-output cell-output-display" data-execution_count="47">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">course_id_1</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-190</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>CS-347</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="joined-relations" class="level2">
<h2 class="anchored" data-anchor-id="joined-relations">Joined Relations</h2>
<ul>
<li><p>Join operations take two relations and return as a result another relation</p></li>
<li><p>These additional operations are typically used as subquery expressions in the <strong>from</strong> clause</p></li>
<li><p><em>Join condition</em> – defines which tuples in the two relations match, and what attributes are present in the result of the join</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">natural</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">on</span> <span class="op">&lt;</span>predicate<span class="op">&gt;</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">using</span> (attr1, attr2, <span class="op">..</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><em>Join type</em> – defines how tuples in each relation that do not match any tuple in the other relation (based on the join condition) are treated</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inner</span> <span class="kw">join</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">left</span> <span class="kw">outer</span> <span class="kw">join</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">right</span> <span class="kw">outer</span> <span class="kw">join</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">full</span> <span class="kw">outer</span> <span class="kw">join</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="full-outer-join" class="level2">
<h2 class="anchored" data-anchor-id="full-outer-join">Full Outer Join</h2>
<ul>
<li>course <strong>full outer join</strong> prereq</li>
</ul>
<div id="cell-149" class="cell" data-execution_count="49">
<div class="cell-output cell-output-display" data-execution_count="49">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">course_id_1</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-190</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
<td>None</td>
<td>None</td>
</tr>
<tr class="even">
<td>None</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>CS-347</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="joining-relations---examples" class="level2">
<h2 class="anchored" data-anchor-id="joining-relations---examples">Joining Relations - Examples</h2>
<ul>
<li><p>course <strong>inner join</strong> prereq <strong>on</strong></p>
<p>course.course_id = prereq.course_id</p></li>
</ul>
<div id="cell-152" class="cell" data-execution_count="51">
<div class="cell-output cell-output-display" data-execution_count="51">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">course_id_1</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-190</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li><p>What is the difference between the above (equi-join) and the natural join?</p></li>
<li><p>course <strong>left outer join</strong> prereq <strong>on</strong></p>
<p>course.course_id = prereq.course_id</p></li>
</ul>
<div id="cell-154" class="cell" data-execution_count="52">
<div class="cell-output cell-output-display" data-execution_count="52">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">course_id_1</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-301</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-190</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
<td>None</td>
<td>None</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>course <strong>natural right outer join</strong> prereq</li>
</ul>
<div id="cell-157" class="cell" data-execution_count="54">
<div class="cell-output cell-output-display" data-execution_count="54">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>CS-347</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
<ul>
<li>course <strong>full outer join</strong> prereq <strong>using</strong> (course_id)</li>
</ul>
<div id="cell-160" class="cell" data-execution_count="63">
<div class="cell-output cell-output-display" data-execution_count="63">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">course_id</th>
<th data-quarto-table-cell-role="th">title</th>
<th data-quarto-table-cell-role="th">dept_name</th>
<th data-quarto-table-cell-role="th">credits</th>
<th data-quarto-table-cell-role="th">prereq_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>BIO-301</td>
<td>Genetics</td>
<td>Biology</td>
<td>4</td>
<td>BIO-101</td>
</tr>
<tr class="even">
<td>CS-190</td>
<td>Game Design</td>
<td>Comp. Sci.</td>
<td>4</td>
<td>CS-101</td>
</tr>
<tr class="odd">
<td>CS-315</td>
<td>Robotics</td>
<td>Comp. Sci.</td>
<td>3</td>
<td>None</td>
</tr>
<tr class="even">
<td>CS-347</td>
<td>None</td>
<td>None</td>
<td>None</td>
<td>CS-101</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="views" class="level2">
<h2 class="anchored" data-anchor-id="views">Views</h2>
<ul>
<li><p>In some cases, it is not desirable for all users to see the entire logical model (that is, all the actual relations stored in the database.)</p></li>
<li><p>Consider a person who needs to know an instructors name and department, but not the salary. This person should see a relation described, in SQL, by:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">ID</span>, name, dept_name</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>A <strong>view</strong> provides a mechanism to hide certain data from the view of certain users</p></li>
<li><p>Any relation that is not of the conceptual model but is made visible to a user as a “virtual relation” is called a <strong>view</strong>.</p></li>
</ul>
</section>
<section id="view-definition" class="level2">
<h2 class="anchored" data-anchor-id="view-definition">View Definition</h2>
<ul>
<li><p>A view is defined using the create view statement which has the form</p>
<pre><code>create view v as &lt; query expression &gt;</code></pre>
<p>where &lt; query expression &gt; is any legal SQL expression</p></li>
<li><p>The view name is represented by v</p></li>
<li><p>Once a view is defined, the view name can be used to refer to the virtual relation that the view generates</p></li>
<li><p>View definition is not the same as creating a new relation by evaluating the query expression</p>
<ul>
<li>Rather, a view definition causes the saving of an expression; the expression is substituted into queries using the view</li>
</ul></li>
</ul>
</section>
<section id="example-views" class="level2">
<h2 class="anchored" data-anchor-id="example-views">Example Views</h2>
<ul>
<li><p>A view of instructors without their salary</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">view</span> faculty <span class="kw">as</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> <span class="kw">ID</span>, name, dept_name</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="kw">from</span> instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>A view of all instructors in the Biology department</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="kw">select</span> name</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> faculty</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> dept_name <span class="op">=</span> <span class="st">'Biology'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Create a view of department salary totals</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">view</span> departments_total_salary(dept_name, total_salary) <span class="kw">as</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> dept_name, <span class="fu">sum</span>(salary)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> instructor</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">group</span> <span class="kw">by</span> dept_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="views-defined-using-other-views" class="level2">
<h2 class="anchored" data-anchor-id="views-defined-using-other-views">Views Defined Using Other Views</h2>
<div class="sourceCode" id="cb82"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">view</span> physics_fall_2009 <span class="kw">as</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">select</span> course.course_id, sec_id, building, room_number</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> course, section</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">where</span> course.course_id <span class="op">=</span> section.course_id</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">and</span> course.dept_name <span class="op">=</span> <span class="st">'Physics'</span></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">and</span> section.semester <span class="op">=</span> <span class="st">'Fall'</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">and</span> section.<span class="dt">year</span> <span class="op">=</span> <span class="dv">2009</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">view</span> physics_fall_2009_watson <span class="kw">as</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">select</span> course_id, room_number</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> physics_fall_2009</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">where</span> building <span class="op">=</span> <span class="st">'Watson'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="view-expansion" class="level2">
<h2 class="anchored" data-anchor-id="view-expansion">View Expansion</h2>
<ul>
<li>Expand use of a view in a query/another view</li>
</ul>
<div class="sourceCode" id="cb84"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">view</span> physics_fall_2009_watson <span class="kw">as</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">select</span> course_id, room_number</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> (<span class="kw">select</span> course.course_id, building, room_number</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">from</span> course, section</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">where</span> course.course_id <span class="op">=</span> section.course_id</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> course.dept_name <span class="op">=</span> <span class="st">'Physics'</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> section.semester <span class="op">=</span> <span class="st">'Fall'</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>                <span class="kw">and</span> section.<span class="dt">year</span> <span class="op">=</span> <span class="dv">2009</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">where</span> building <span class="op">=</span> <span class="st">'Watson'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="view-defined-using-other-views" class="level2">
<h2 class="anchored" data-anchor-id="view-defined-using-other-views">View Defined Using Other Views</h2>
<ul>
<li><p>One view may be used in the expression defining another view</p></li>
<li><p>A view relation <span class="math inline">v_1</span> is said to <u><em>depend directly</em></u> on a view relation <span class="math inline">v_2</span> if <span class="math inline">v_2</span> is used in the expression defining <span class="math inline">v_1</span></p></li>
<li><p>A view relation <span class="math inline">v_1</span> is said to <u><em>depend on</em></u> view relation <span class="math inline">v_2</span> if either <span class="math inline">v_1</span> depends directly on <span class="math inline">v_2</span> or there is a path of dependencies from <span class="math inline">v_1</span> to <span class="math inline">v_2</span></p></li>
<li><p>A view relation v is said to be <u><em>recursive</em></u> if it depends on itself</p></li>
</ul>
</section>
<section id="view-expansion-1" class="level2">
<h2 class="anchored" data-anchor-id="view-expansion-1">View Expansion*</h2>
<ul>
<li><p>A way to define the meaning of views defined in terms of other views</p></li>
<li><p>Let view <span class="math inline">v_1</span> be defined by an expression <span class="math inline">e_1</span> that may itself contain uses of view relations</p></li>
<li><p>View expansion of an expression repeats the following replacement step:</p>
<p><strong>repeat</strong></p>
<ul>
<li>Find any view relation <span class="math inline">v_i</span> in <span class="math inline">e_1</span></li>
<li>Replace the view relation <span class="math inline">v_i</span> by the expression defining <span class="math inline">v_i</span></li>
</ul>
<p><strong>until</strong> no more view relations are present in <span class="math inline">e_1</span></p></li>
<li><p>As long as the view definitions are not recursive, this loop will terminate</p></li>
</ul>
</section>
<section id="update-of-a-view" class="level2">
<h2 class="anchored" data-anchor-id="update-of-a-view">Update of a View</h2>
<ul>
<li><p>Add a new tuple to <em>faculty</em> view which we defined earlier</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">insert</span> <span class="kw">into</span> faculty <span class="kw">values</span> (’<span class="dv">30765</span>’, ’Green’, ’Music’);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>This insertion must be represented by the insertion of the tuple</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>  (’<span class="dv">30765</span>’, ’Green’, ’Music’, <span class="kw">null</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>into the instructor relation</p></li>
</ul>
</section>
<section id="some-updates-cannot-be-translated-uniquely" class="level2">
<h2 class="anchored" data-anchor-id="some-updates-cannot-be-translated-uniquely">Some Updates cannot be Translated Uniquely</h2>
<ul>
<li><div class="sourceCode" id="cb87"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">view</span> instructor_info <span class="kw">as</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">select</span> <span class="kw">ID</span>, name, building</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> instructor, department</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">where</span> instructor.dept_name <span class="op">=</span> department.dept_name;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><div class="sourceCode" id="cb88"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">insert</span> <span class="kw">into</span> instructor info <span class="kw">values</span> (<span class="st">'69987'</span>, <span class="st">'White'</span>, <span class="st">'Taylor'</span>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>which department, if multiple departments in Taylor?</li>
<li>what if no department is in Taylor?</li>
</ul></li>
<li>Most SQL implementations allow updates only on simple views
<ul>
<li>The <strong>from</strong> clause has only one database relation</li>
<li>The <strong>select</strong> clause contains only attribute names of the relation, and does not have any expressions aggregates, or <strong>distinct</strong> specification</li>
<li>Any attribute not listed in the <strong>select</strong> clause can be set to null</li>
<li>The query does not have a <strong>group by</strong> or <strong>having</strong> clause</li>
</ul></li>
</ul>
</section>
<section id="and-some-not-at-all" class="level2">
<h2 class="anchored" data-anchor-id="and-some-not-at-all">And Some Not at All</h2>
<ul>
<li><div class="sourceCode" id="cb89"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">view</span> history_instructors <span class="kw">as</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">select</span> <span class="op">*</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">from</span> instructor</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">where</span> dept_name <span class="op">=</span> <span class="st">'History'</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>What happens if we insert (’25566’, ’Brown’, ’Biology’, 100000) into history_instructors?</li>
</ul>
</section>
<section id="materialized-views" class="level2">
<h2 class="anchored" data-anchor-id="materialized-views">Materialized Views</h2>
<ul>
<li><p><strong>Materializing a view</strong>: create a physical table containing all the tuples in the result of the query defining the view</p></li>
<li><p>If relations used in the query are updated, the materialized view result becomes out of date</p>
<ul>
<li>Need to <strong>maintain</strong> the view, by updating the view whenever the underlying relations are updated</li>
</ul></li>
</ul>
</section>
</section>
<section id="lecture-3.4-intermediate-sql3" class="level1">
<h1>Lecture 3.4: Intermediate SQL/3</h1>
<section id="transactions" class="level2">
<h2 class="anchored" data-anchor-id="transactions">Transactions</h2>
<ul>
<li>Unit of work</li>
<li>Atomic transaction
<ul>
<li>either fully executed or rolled back as if it never happened</li>
</ul></li>
<li>Isolation from concurrent transactions</li>
<li>Transactions begin implicitly
<ul>
<li>End by <strong>commit work</strong> or <strong>rollback work</strong></li>
</ul></li>
<li>But default on most databases: each SQL statement commits automatically
<ul>
<li>Can turn off auto-commit for a session (for example, using API)</li>
<li>In SQL:1999, can use: <strong>begin atomic … end</strong>
<ul>
<li>Not supported on most databases</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="integrity-constraints" class="level2">
<h2 class="anchored" data-anchor-id="integrity-constraints">Integrity Constraints</h2>
<ul>
<li>Integrity constraints guard against accidental damage to the database, by ensuring that authorized changes to the database do not result in a loss of data consistency
<ul>
<li>A checking account must have a balance greater than Rs. 10,000.00</li>
<li>A salary of a bank employee must be at least Rs. 250.00 an hour</li>
<li>A customer must have a (non-null) phone number</li>
</ul></li>
</ul>
</section>
<section id="integrity-constraints-on-a-single-relation" class="level2">
<h2 class="anchored" data-anchor-id="integrity-constraints-on-a-single-relation">Integrity Constraints on a Single Relation</h2>
<ul>
<li><strong>not null</strong></li>
<li><strong>primary key</strong></li>
<li><strong>unique</strong></li>
<li><strong>check</strong>(P), where P is a predicate</li>
</ul>
</section>
<section id="not-null-and-unique-constraints" class="level2">
<h2 class="anchored" data-anchor-id="not-null-and-unique-constraints">Not Null and Unique Constraints</h2>
<ul>
<li><strong>not null</strong>
<ul>
<li><p>Declare name and budget to be not null</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>name <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>budget <span class="dt">numeric</span>(<span class="dv">12</span>, <span class="dv">2</span>) <span class="kw">not</span> <span class="kw">null</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><strong>unique</strong> <span class="math inline">(A_1, A_2, ..., A_m)</span>
<ul>
<li>The unique specification states that the attributes <span class="math inline">A_1, A_2, ..., A_m</span> form a candidate key</li>
<li>Candidate keys are permeitted to be null (unlike primary keys)</li>
</ul></li>
</ul>
</section>
<section id="the-check-clause" class="level2">
<h2 class="anchored" data-anchor-id="the-check-clause">The check clause</h2>
<ul>
<li><p><strong>check</strong>(P), where P is a predicate</p></li>
<li><p>Ensure that semester is one of fall, winter, spring, or summer:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="kw">create</span> <span class="kw">table</span> section (</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  course_id <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>  sec_id <span class="dt">varchar</span>(<span class="dv">8</span>),</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>  semester <span class="dt">varchar</span>(<span class="dv">6</span>),</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">year</span> <span class="dt">numeric</span>(<span class="dv">4</span>, <span class="dv">0</span>),</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>  building <span class="dt">varchar</span>(<span class="dv">15</span>),</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>  room_number <span class="dt">varchar</span>(<span class="dv">7</span>),</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>  time_slot_id <span class="dt">varchar</span>(<span class="dv">4</span>),</span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">primary</span> <span class="kw">key</span> (course_id, sec_id, semester, <span class="dt">year</span>),</span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">check</span> (semester <span class="kw">in</span> (<span class="st">'fall'</span>, <span class="st">'winter'</span>, <span class="st">'spring'</span>, <span class="st">'summer'</span>))</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="referential-integrity" class="level2">
<h2 class="anchored" data-anchor-id="referential-integrity">Referential Integrity</h2>
<ul>
<li><p>Ensures that a value that appears in one relation for a given set of attributes also appears for a certain set of attributes in another relation</p></li>
<li><p>Example: If “Biology” is a department name appearing in one of the tuples in the instructor relation, then there exists a tuple in the department relation for “Biology”</p></li>
<li><p>Let A be a set of attributes. Let R and S be two relations that contain attributes A and where A is the primary key of S. A is said to be a <strong>foreign key</strong> of R if for any values of A appearing in R these values also appear in S</p></li>
</ul>
</section>
<section id="cascading-actions-in-referential-integrity" class="level2">
<h2 class="anchored" data-anchor-id="cascading-actions-in-referential-integrity">Cascading Actions in Referential Integrity</h2>
<ul>
<li><p>With cascading, you can define the actions that the Database Engine takes when a user tries to delete or update a key to which existing foreign keys point</p></li>
<li><div class="sourceCode" id="cb92"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">table</span> course (</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>        course_id <span class="dt">char</span>(<span class="dv">5</span>) <span class="kw">primary</span> <span class="kw">key</span>,</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>        title <span class="dt">varchar</span>(<span class="dv">20</span>),</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>        dept_name <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">references</span> department</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    );</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><div class="sourceCode" id="cb93"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">table</span> course (</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">..</span>.</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>        dept_name <span class="dt">varchar</span>(<span class="dv">20</span>),</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreign</span> <span class="kw">key</span> (dept_name) <span class="kw">references</span> department</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">on</span> <span class="kw">delete</span> <span class="kw">cascade</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">on</span> <span class="kw">update</span> <span class="kw">cascade</span>,</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">..</span>.</span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>    );</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Alternative actions to cascade: <strong>no action</strong>, <strong>set null</strong>, <strong>set default</strong></p></li>
</ul>
</section>
<section id="integrity-constraint-violation-during-transactions" class="level2">
<h2 class="anchored" data-anchor-id="integrity-constraint-violation-during-transactions">Integrity Constraint Violation During Transactions</h2>
<ul>
<li><div class="sourceCode" id="cb94"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">table</span> person (</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>        <span class="kw">ID</span> <span class="dt">char</span>(<span class="dv">10</span>),</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>        name <span class="dt">char</span>(<span class="dv">40</span>),</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>        mother <span class="dt">char</span>(<span class="dv">10</span>),</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>        father <span class="dt">char</span>(<span class="dv">10</span>),</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">primary</span> <span class="kw">key</span> <span class="kw">ID</span>,</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreign</span> <span class="kw">key</span> father <span class="kw">references</span> person,</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">foreign</span> <span class="kw">key</span> mother <span class="kw">references</span> person)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li>How to insert a tuple without causing constraint violation?
<ul>
<li>Insert father and mother of a person before inserting person</li>
<li>OR, Set father and mother to null initially, update after inserting all persons (not possible if father and mother attributes declared to be not null)</li>
<li>OR Defer constraint checking (will discuss later)</li>
</ul></li>
</ul>
</section>
<section id="built-in-data-types-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="built-in-data-types-in-sql">Built-in Data Types in SQL</h2>
<ul>
<li><strong>date</strong>: Dates, containing a (4 digit) year, month and date
<ul>
<li>Example: <strong>date</strong> ‘2005-7-27’</li>
</ul></li>
<li><strong>time</strong>: Time of day, in hours, minutes and seconds.
<ul>
<li>Example: <strong>time</strong> ‘09:00:30’ time ‘09:00:30.75’</li>
</ul></li>
<li><strong>timestamp</strong>: date plus time of day
<ul>
<li>Example: <strong>timestamp</strong> ‘2005-7-27 09:00:30.75’</li>
</ul></li>
<li><strong>interval</strong>: period of time
<ul>
<li>Example: <strong>interval</strong> ‘1’ day</li>
<li>Subtracting a date/time/timestamp value from another gives an interval value</li>
<li>Interval values can be added to date/time/timestamp values</li>
</ul></li>
</ul>
</section>
<section id="index-creation" class="level2">
<h2 class="anchored" data-anchor-id="index-creation">Index Creation</h2>
<ul>
<li><div class="sourceCode" id="cb95"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">table</span> student(<span class="kw">ID</span> <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    name <span class="dt">varchar</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span>,</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    dept_name <span class="dt">varchar</span>(<span class="dv">20</span>),</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    tot cred <span class="dt">numeric</span> (<span class="dv">3</span>,<span class="dv">0</span>) <span class="kw">default</span> <span class="dv">0</span>,</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">primary</span> <span class="kw">key</span> (<span class="kw">ID</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>create index studentID index on student(ID)</p></li>
<li><p>Indices are data structures used to speed up access to records with specified values for index attributes</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="op">*</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> student</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span> <span class="kw">ID</span> <span class="op">=</span> <span class="st">'12345'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Can be executed by using the index to find the required record, without looking at all records of student</li>
</ul></li>
</ul>
</section>
<section id="user-defined-types" class="level2">
<h2 class="anchored" data-anchor-id="user-defined-types">User Defined Types</h2>
<ul>
<li><p><strong>create type</strong> construct in SQL creates user-defined type (alias, like typedef in C)</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">type</span> Dollars <span class="kw">as</span> <span class="dt">numeric</span> (<span class="dv">12</span>,<span class="dv">2</span>) final</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><div class="sourceCode" id="cb98"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">table</span> department (</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>        dept_name <span class="dt">varchar</span> (<span class="dv">20</span>),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>        building <span class="dt">varchar</span> (<span class="dv">15</span>),</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>        budget Dollars</span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>    );</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="domains" class="level2">
<h2 class="anchored" data-anchor-id="domains">Domains</h2>
<ul>
<li><p><strong>create domain</strong> construct in SQL-92 creates user-defined domain types</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">domain</span> person_name <span class="dt">char</span>(<span class="dv">20</span>) <span class="kw">not</span> <span class="kw">null</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Types and domains are similar</p></li>
<li><p>Domains can have constraints, such as <strong>not null</strong> specified on them</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">domain</span> degree_level <span class="dt">varchar</span>(<span class="dv">10</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constraint</span> degree_level_test</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">check</span> (<span class="fu">value</span> <span class="kw">in</span> (<span class="st">'Bachelors'</span>, <span class="st">'Masters'</span>, <span class="st">'Doctorate'</span>));</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="large-object-types" class="level2">
<h2 class="anchored" data-anchor-id="large-object-types">Large-Object Types</h2>
<ul>
<li>Large objects (photos, videos, CAD files, etc.) are stored as a large object:
<ul>
<li><strong>blob</strong>: binary large object – object is a large collection of uninterpreted binary data (whose interpretation is left to an application outside of the database system)</li>
<li><strong>clob</strong>: character large object – object is a large collection of character data</li>
<li>When a query returns a large object, a pointer is returned rather than the large object itself</li>
</ul></li>
</ul>
</section>
<section id="authorization" class="level2">
<h2 class="anchored" data-anchor-id="authorization">Authorization</h2>
<ul>
<li>Forms of authorization on parts of the database:
<ul>
<li><strong>Read</strong> - allows reading, but not modification of data</li>
<li><strong>Insert</strong> - allows insertion of new data, but not modification of existing data</li>
<li><strong>Update</strong> - allows modification, but not deletion of data</li>
<li><strong>Delete</strong> - allows deletion of data</li>
</ul></li>
<li>Forms of authorization to modify the database schema
<ul>
<li><strong>Index</strong> - allows creation and deletion of indices</li>
<li><strong>Resources</strong> - allows creation of new relations</li>
<li><strong>Alteration</strong> - allows addition or deletion of attributes in a relation</li>
<li><strong>Drop</strong> - allows deletion of relations</li>
</ul></li>
</ul>
</section>
<section id="authorization-specification-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="authorization-specification-in-sql">Authorization Specification in SQL</h2>
<ul>
<li><p>The grant statement is used to confer authorization</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">grant</span> <span class="op">&lt;</span><span class="kw">privilege</span> <span class="kw">list</span><span class="op">&gt;</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">on</span> <span class="op">&lt;</span>relation name <span class="kw">or</span> <span class="kw">view</span> name<span class="op">&gt;</span> <span class="kw">to</span> <span class="op">&lt;</span><span class="fu">user</span> <span class="kw">list</span><span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="math inline">\text{&lt;user list&gt;}</span> is:</p>
<ul>
<li>a user-id</li>
<li><strong>public</strong>, which allows all valid users the privilege granted</li>
<li>A role (more on this later)</li>
</ul></li>
<li><p>Granting a privilege on a view does not imply granting any privileges on the underlying relations</p></li>
<li><p>The grantor of the privilege must already hold the privilege on the specified item (or be the database administrator)</p></li>
</ul>
</section>
<section id="privileges-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="privileges-in-sql">Privileges in SQL</h2>
<ul>
<li><p><strong>select</strong>: allows read access to relation, or the ability to query using the view</p>
<ul>
<li><p>Example: grant users <span class="math inline">U_1</span>, <span class="math inline">U_2</span>, and <span class="math inline">U_3</span> <strong>select</strong> authorization on the instructor relation:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">grant</span> <span class="kw">select</span> <span class="kw">on</span> instructor <span class="kw">to</span> U1, U2, U3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul></li>
<li><p><strong>insert</strong>: the ability to insert tuples</p></li>
<li><p><strong>update</strong>: the ability to update tuples</p></li>
<li><p><strong>delete</strong>: the ability to delete tuples</p></li>
<li><p><strong>all privileges</strong>: used as a short form for all the allowable privileges</p></li>
</ul>
</section>
<section id="revoking-authorization-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="revoking-authorization-in-sql">Revoking Authorization in SQL</h2>
<ul>
<li><p>The <strong>revoke</strong> statement is used to revoke authorization</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">revoke</span> <span class="op">&lt;</span><span class="kw">privilege</span> <span class="kw">list</span><span class="op">&gt;</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">on</span> <span class="op">&lt;</span>relation name <span class="kw">or</span> <span class="kw">view</span> name<span class="op">&gt;</span> <span class="kw">from</span> <span class="op">&lt;</span><span class="fu">user</span> <span class="kw">list</span><span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Example:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">revoke</span> <span class="kw">select</span> <span class="kw">on</span> branch <span class="kw">from</span> U1, U2, U3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><span class="math inline">\text{&lt;privilege-list&gt;}</span> may be <em>all</em> to revoke all privileges the revokee may hold</p></li>
<li><p>If <span class="math inline">\text{&lt;revokee-list&gt;}</span> includes <em>public</em>, all users lose the privilege except those granted it explicitly</p></li>
<li><p>If the same privilege was granted twice to the same user by different grantees, the user may retain the privilege after the revocation</p></li>
<li><p>All privileges that depend on the privilege being revoked are also revoked</p></li>
</ul>
</section>
<section id="roles" class="level2">
<h2 class="anchored" data-anchor-id="roles">Roles</h2>
<ul>
<li><div class="sourceCode" id="cb105"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">role</span> instructor;</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">grant</span> instructor <span class="kw">to</span> Amit;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Privileges can be granted to roles:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">grant</span> <span class="kw">select</span> <span class="kw">on</span> takes <span class="kw">to</span> instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Roles can be granted to users, as well as to other roles</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">role</span> teaching_assistant;</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">grant</span> teaching_assistant <span class="kw">to</span> instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>Instructor inherits all privileges of teaching_assistant</li>
</ul></li>
<li><p>Chain of roles</p>
<ul>
<li><strong>create role</strong> dean;</li>
<li><strong>grant</strong> instructor <strong>to</strong> dean;</li>
<li><strong>grant</strong> dean <strong>to</strong> Satoshi;</li>
</ul></li>
</ul>
</section>
<section id="authorization-on-views" class="level2">
<h2 class="anchored" data-anchor-id="authorization-on-views">Authorization on Views</h2>
<ul>
<li><div class="sourceCode" id="cb108"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">view</span> geo_instructor <span class="kw">as</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>    (<span class="kw">select</span> <span class="op">*</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> instructor</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> dept_name <span class="op">=</span> ’Geology’);</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">grant</span> <span class="kw">select</span> <span class="kw">on</span> geo_instructor <span class="kw">to</span> geo_staff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Suppose that a geo_staff member issues</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="op">*</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> geo_instructor;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>What if</p>
<ul>
<li>geo_staff does not have permissions on instructor?</li>
<li>creator of view did not have some permissions on instructor?</li>
</ul></li>
</ul>
</section>
<section id="other-authorization-features" class="level2">
<h2 class="anchored" data-anchor-id="other-authorization-features">Other Authorization Features</h2>
<ul>
<li><p><strong>references</strong> privilege to create foreign key</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">grant</span> reference (dept_name) <span class="kw">on</span> department <span class="kw">to</span> Mariano;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>why is this required?</li>
</ul></li>
<li><p>Transfer of privileges</p>
<ul>
<li><strong>grant select on</strong> department <strong>to</strong> Amit <strong>with grant option</strong>;</li>
<li><strong>revoke select on</strong> department <strong>from</strong> Amit, Satoshi <strong>cascade</strong>;</li>
<li><strong>revoke select on</strong> department <strong>from</strong> Amit, Satoshi <strong>restrict</strong>;</li>
</ul></li>
</ul>
</section>
</section>
<section id="lecture-3.5-advanced-sql" class="level1">
<h1>Lecture 3.5: Advanced SQL</h1>
<section id="native-language-query-language" class="level2">
<h2 class="anchored" data-anchor-id="native-language-query-language">Native Language ← → Query Language</h2>
<p><img src="aaa.svg" class="img-fluid"></p>
</section>
<section id="functions-and-procedures" class="level2">
<h2 class="anchored" data-anchor-id="functions-and-procedures">Functions and Procedures</h2>
<ul>
<li>Functions / Procedures and Control Flow Statements were added in SQL:1999
<ul>
<li>Functions/Procedures can be written in SQL itself, or in an external programming language (like C, Java)</li>
<li>Functions written in an external languages are particularly useful with specialized data types such as images and geometric objects
<ul>
<li>Example: Functions to check if polygons overlap, or to compare images for similarity</li>
</ul></li>
<li>Some database systems support table-valued functions, which can return a relation as a result</li>
</ul></li>
<li>SQL:1999 also supports a rich set of imperative constructs, including loops, if-then-else, and assignment</li>
<li>Many databases have proprietary procedural extensions to SQL that differ from SQL:1999</li>
</ul>
</section>
<section id="sql-functions" class="level2">
<h2 class="anchored" data-anchor-id="sql-functions">SQL Functions</h2>
<ul>
<li><p>Define a function that, given the name of a department, returns the count of the number of instructors in that department:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">function</span> dept_count (dept name <span class="dt">varchar</span>(<span class="dv">20</span>))</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>        returns <span class="dt">integer</span></span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">begin</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">declare</span> d_count <span class="dt">integer</span>;</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">select</span> <span class="fu">count</span> (<span class="op">*</span>) <span class="kw">into</span> d_count</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>            <span class="kw">from</span> instructor</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>            <span class="kw">where</span> instructor.dept_name <span class="op">=</span> dept_name</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> d_cont;</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The function dept count can be used to find the department names and budget of all departments with more that 12 instructors:</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">select</span> dept_name, budget</span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">from</span> department</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span> dept_count (dept_name ) <span class="op">&gt;</span> <span class="dv">12</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sql-functions-2" class="level2">
<h2 class="anchored" data-anchor-id="sql-functions-2">SQL Functions (2)</h2>
<ul>
<li><p>Compound statement: <strong>begin . . . end</strong> May contain multiple SQL statements between begin and end.</p></li>
<li><p><strong>returns</strong> – indicates the variable-type that is returned (for example, integer)</p></li>
<li><p><strong>return</strong> – specifies the values that are to be returned as result of invoking the function</p></li>
<li><p>SQL function are in fact <em>parameterized views</em> that generalize the regular notion of views by allowing parameters</p></li>
</ul>
</section>
<section id="table-functions" class="level2">
<h2 class="anchored" data-anchor-id="table-functions">Table Functions</h2>
<ul>
<li><p>Functions that return a relation as a result added in SQL:2003</p></li>
<li><p>Return all instructors in a given department:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">function</span> instructor_of (dept_name <span class="dt">char</span>(<span class="dv">20</span>))</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    returns <span class="kw">table</span> (</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">ID</span> <span class="dt">varchar</span>(<span class="dv">5</span>),</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>      name <span class="dt">varchar</span>(<span class="dv">20</span>),</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>      dept_name <span class="dt">varchar</span>(<span class="dv">20</span>)</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>      salary <span class="dt">numeric</span>(<span class="dv">8</span>, <span class="dv">2</span>) )</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    returns <span class="kw">table</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>      (<span class="kw">select</span> <span class="kw">ID</span>, name, dept_name, salary</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">from</span> instructor</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a>      <span class="kw">where</span> instructor.dept_name <span class="op">=</span> instructor_of.dept_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Usage</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">select</span> <span class="op">*</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">from</span> <span class="kw">table</span> (instructor_of (‘Music’))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="sql-procedures" class="level2">
<h2 class="anchored" data-anchor-id="sql-procedures">SQL Procedures</h2>
<ul>
<li><p>The dept count function could instead be written as procedure:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>      <span class="kw">create</span> <span class="kw">procedure</span> dept_count_proc (</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>          <span class="kw">in</span> dept_name <span class="dt">varchar</span> (<span class="dv">20</span>), <span class="kw">out</span> d_count <span class="dt">integer</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>          <span class="cf">begin</span></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>              <span class="kw">select</span> <span class="fu">count</span>(<span class="op">*</span>) <span class="kw">into</span> d_count</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>              <span class="kw">from</span> instructor</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a>              <span class="kw">where</span> instructor.dept_name <span class="op">=</span> dept_count_proc.dept_name</span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a>          <span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Procedures can be invoked either from an SQL procedure or from embedded SQL, using the <strong>call</strong> statement.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="kw">declare</span> d_count <span class="dt">integer</span>;</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="kw">call</span> dept_count_proc(‘Physics’, d_count);</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Procedures and functions can be invoked also from dynamic SQL</p></li>
<li><p>SQL:1999 allows <strong>overloading</strong> - more than one function/procedure of the same name as long as the number of arguments and/or the types of the arguments differ</p></li>
</ul>
</section>
<section id="language-constructs-for-procedures-and-functions" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-for-procedures-and-functions">Language Constructs for Procedures and Functions</h2>
<ul>
<li>SQL supports constructs that gives it almost all the power of a general-purpose programming language.
<ul>
<li>Warning: <strong>Most database systems implement their own variant of the standard syntax</strong></li>
</ul></li>
<li>Compound statements: <strong>begin . . . end</strong>
<ul>
<li>May contain multiple SQL statements between <strong>begin</strong> and <strong>end</strong></li>
<li>Local variables can be declared within a compound statement</li>
</ul></li>
</ul>
</section>
<section id="language-constructs-2-while-and-repeat" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-2-while-and-repeat">Language Constructs (2): while and repeat</h2>
<ul>
<li><p><strong>while</strong> loop</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>     <span class="cf">while</span> boolean_expression do</span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>         sequence_of_statements;</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>     <span class="cf">end</span> <span class="cf">while</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>repeat</strong> loop</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>    repeat</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>        sequence_of_statements;</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">until</span> boolean_expression;</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span> repeat;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="language-constructs-3-for" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-3-for">Language Constructs (3): for</h2>
<ul>
<li><p><strong>for</strong> loop</p>
<ul>
<li>Permits iteration over all results of a query</li>
</ul></li>
<li><p>Find the budget if all departments:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">declare</span> n <span class="dt">integer</span> <span class="kw">default</span> <span class="dv">0</span>;</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> r <span class="kw">as</span></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a>      <span class="kw">select</span> budget <span class="kw">from</span> department</span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a>    do</span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span> n <span class="op">=</span> n <span class="op">+</span> r.budget</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span> <span class="cf">for</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="language-constructs-4-if-then-else" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-4-if-then-else">Language Constructs (4): if-then-else</h2>
<ul>
<li><p>Conditional statements</p>
<ul>
<li><strong>if</strong>-<strong>then</strong>-<strong>else</strong></li>
<li><strong>case</strong></li>
</ul></li>
<li><p><strong>if</strong>-<strong>then</strong>-<strong>else</strong> statement</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> boolean_expression <span class="cf">then</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>        sequence_of_statements;</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    elseif boolean_expression <span class="cf">then</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>        sequence_of_statements;</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">..</span>.</span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>        sequence_of_statements;</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span> <span class="cf">if</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The <strong>if</strong> statement supports the use of optional <strong>elseif</strong> clauses and a default <strong>else</strong> clause</p></li>
<li><p>Example procedure: registers student after ensuring that classroom capacity is not exceeded</p>
<ul>
<li>Returns 0 on success and -1 if capacity is exceeded</li>
</ul></li>
</ul>
</section>
<section id="language-constructs-5-simple-case" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-5-simple-case">Language Constructs (5): Simple case</h2>
<ul>
<li><p>Simple <strong>case</strong> statement</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> variable</span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">when</span> value1 <span class="cf">then</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>            sequence_of_statements;</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">when</span> value2 <span class="cf">then</span></span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>            sequence_of_statements;</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">..</span>.</span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>            sequence_of_statements;</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span> <span class="cf">case</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>The <strong>when</strong> clause of the <strong>case</strong> statement defines the value that when satisfied determines the flow of control</p></li>
</ul>
</section>
<section id="language-constructs-6-searched-case" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-6-searched-case">Language Constructs (6): Searched case</h2>
<ul>
<li><p>Searched <strong>case</strong> statements</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">when</span> sql_expression <span class="op">=</span> value1 <span class="cf">then</span></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>            sequence_of_statements;</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">when</span> sql_expression <span class="op">=</span> value2 <span class="cf">then</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>            sequence_of_statements;</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">..</span>.</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a>            sequence_of_statements;</span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span> <span class="cf">case</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Any supported SQL expression can be used here. These expressions can contain references to variables, parameters, special registers, and more.</p></li>
</ul>
</section>
<section id="language-constructs-7-exception" class="level2">
<h2 class="anchored" data-anchor-id="language-constructs-7-exception">Language Constructs (7): Exception</h2>
<ul>
<li><p>Signaling of exception conditions, and declaring handlers for exceptions</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">declare</span> out_of_classroom_seats condition</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">declare</span> exit handler <span class="cf">for</span> out_of_classroom_seats</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">begin</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">..</span>.</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>        signal out_of_classroom_seats</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">..</span>.</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>The handler here is <strong>exit</strong> – causes enclosing <strong>begin . . . end</strong> to be terminate and exit</li>
<li>Other actions possible on exception</li>
</ul></li>
</ul>
</section>
<section id="external-language-routines" class="level2">
<h2 class="anchored" data-anchor-id="external-language-routines">External Language Routines*</h2>
<ul>
<li><p>SQL:1999 allows the definition of functions and procedures in an external / imperative programming language, (Java, C#, C, or C++) which can be invoked from SQL queries</p></li>
<li><p>Such functions can be more efficient than functions defined in SQL, and computations that cannot be carried out in SQL can be executed by these functions</p></li>
<li><p>Declaring external language procedures and functions</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">procedure</span> dept_count_proc(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>            <span class="kw">in</span> dept_name <span class="dt">varchar</span>(<span class="dv">20</span>),</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>            <span class="kw">out</span> <span class="fu">count</span> <span class="dt">integer</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>        language C</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>        external name ’<span class="op">/</span>usr<span class="op">/</span>avi<span class="op">/</span>bin<span class="op">/</span>dept_count_proc’</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">create</span> <span class="kw">function</span> dept_count(dept_name <span class="dt">varchar</span>(<span class="dv">20</span>))</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    returns <span class="dt">integer</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>        language C</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>        external name ‘<span class="op">/</span>usr<span class="op">/</span>avi<span class="op">/</span>bin<span class="op">/</span>dept_count’</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="external-language-routines-2" class="level2">
<h2 class="anchored" data-anchor-id="external-language-routines-2">External Language Routines (2)*</h2>
<ul>
<li>Benefits of external language functions/procedures:
<ul>
<li>More efficient for many operations, and more expressive power</li>
</ul></li>
<li>Drawbacks
<ul>
<li>Code to implement function may need to be loaded into database system and executed in the database system’s address space
<ul>
<li>Risk of accidental corruption of database structures</li>
<li>Security risk, allowing users access to unauthorized data</li>
</ul></li>
<li>There are alternatives, which give good security at the cost of performance</li>
<li>Direct execution in the database system’s space is used when efficiency is more important than security</li>
</ul></li>
</ul>
</section>
<section id="external-language-routines-3-security" class="level2">
<h2 class="anchored" data-anchor-id="external-language-routines-3-security">External Language Routines (3)*: Security</h2>
<ul>
<li>To deal with security problems, we can do one of the following:
<ul>
<li>Use <strong>sandbox</strong> techniques
<ul>
<li>That is, use a safe language like Java, which cannot be used to access/damage other parts of the database code</li>
</ul></li>
<li>Run external language functions/procedures in a separate process, with no access to the database process’ memory
<ul>
<li>Parameters and results communicated via inter-process communication</li>
</ul></li>
</ul></li>
<li>Both have performance overheads</li>
<li>Many database systems support both above approaches as well as direct executing in database system address space</li>
</ul>
</section>
<section id="trigger" class="level2">
<h2 class="anchored" data-anchor-id="trigger">Trigger</h2>
<ul>
<li>A <strong>trigger</strong> defines a set of actions that are performed in response to an <strong>insert</strong>, <strong>update</strong>, or <strong>delete</strong> operation on a specified table
<ul>
<li>When such an SQL operation is executed, the trigger is said to have been <strong>activated</strong></li>
<li>Triggers are <strong>optional</strong></li>
<li>Triggers are defined using the <strong>create trigger</strong> statement</li>
</ul></li>
<li>Triggers can be used
<ul>
<li>To enforce data integrity rules via referential constraints and check constraints</li>
<li>To cause updates to other tables, automatically generate or transform values for inserted or updated rows, or invoke functions to perform tasks such as issuing alerts</li>
</ul></li>
<li>To design a trigger mechanism, we must:
<ul>
<li>Specify the <strong>events</strong> / (like <strong>update</strong>, <strong>insert</strong>, or <strong>delete</strong>) for the trigger to executed</li>
<li>Specify the <strong>time</strong> (<strong>BEFORE</strong> or <strong>AFTER</strong>) of execution</li>
<li>Specify the <strong>actions</strong> to be taken when the trigger executes</li>
</ul></li>
<li><strong>Syntax of triggers may vary across systems</strong></li>
</ul>
</section>
<section id="types-of-triggers-before" class="level2">
<h2 class="anchored" data-anchor-id="types-of-triggers-before">Types of Triggers: BEFORE</h2>
<ul>
<li><strong>BEFORE triggers</strong>
<ul>
<li>Run before an <strong>update</strong>, or <strong>insert</strong></li>
<li>Values that are being updated or inserted can be modified before the database is actually modified. You can use triggers that run before an update or insert to:
<ul>
<li>Check or modify values before they are actually updated or inserted in the database
<ul>
<li>Useful if user-view and internal database format differs</li>
</ul></li>
<li>Run other non-database operations coded in user-defined functions</li>
</ul></li>
</ul></li>
<li><strong>BEFORE DELETE triggers</strong>
<ul>
<li>Run before a <strong>delete</strong>
<ul>
<li>Checks values (a raises an error, if necessary)</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="types-of-triggers-2-after" class="level2">
<h2 class="anchored" data-anchor-id="types-of-triggers-2-after">Types of Triggers (2): AFTER</h2>
<ul>
<li><strong>AFTER triggers</strong>
<ul>
<li>Run before an <strong>update</strong>, <strong>insert</strong>, or <strong>delete</strong></li>
<li>You can use triggers that run after an update or insert to:
<ul>
<li>Update data in other tables
<ul>
<li>Useful for maintain relationships between data or keep audit trail</li>
</ul></li>
<li>Check against other data in the table or in other tables
<ul>
<li>Useful to ensure data integrity when referential integrity constraints aren’t appropriate, or</li>
<li>when table check constraints limit checking to the current table only</li>
</ul></li>
<li>Run non-database operations coded in user-defined functions
<ul>
<li>Useful when issuing alerts or to update information outside the database</li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="row-level-and-statement-level-triggers" class="level2">
<h2 class="anchored" data-anchor-id="row-level-and-statement-level-triggers">Row Level and Statement Level Triggers</h2>
<p>There are two types of triggers based on the level at which the triggers are applied:</p>
<ul>
<li><strong>Row level triggers</strong> are executed whenever a row is affected by the event on which the trigger is defined.
<ul>
<li>Let Employee be a table with 100 rows. Suppose an <strong>update</strong> statement is executed to increase the salary of each employee by 10%. Any row level <strong>update</strong> trigger configured on the table Employee will affect all the 100 rows in the table during this update.</li>
</ul></li>
<li><strong>Statement level triggers</strong> perform a single action for all rows affected by a statement, instead of executing a separate action for each affected row.
<ul>
<li>Used for each <strong>statement</strong> instead of for each <strong>row</strong></li>
<li>Uses <strong>referencing old table</strong> or <strong>referencing new table</strong> to refer to temporary tables called <strong>transition tables</strong> containing the affected rows</li>
<li>Can be more efficient when dealing with SQL statements that update a large number of rows</li>
</ul></li>
</ul>
</section>
<section id="triggering-events-and-actions-in-sql" class="level2">
<h2 class="anchored" data-anchor-id="triggering-events-and-actions-in-sql">Triggering Events and Actions in SQL</h2>
<ul>
<li><p>Triggering event can be an insert, delete or update</p></li>
<li><p>Triggers on update can be restricted to specific attributes</p>
<ul>
<li>For example, <strong>after update of</strong> <em>grade</em> <strong>on</strong> <em>takes</em></li>
</ul></li>
<li><p>Values of attributes before and after an update can be referenced</p>
<ul>
<li><strong>referencing old row as</strong> : for deletes and updates</li>
<li><strong>referencing new row as</strong> : for inserts and updates</li>
</ul></li>
<li><p>Triggers can be activated before an event, which can serve as extra constraints. For example, convert blank grades to null.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">trigger</span> setnull_trigger <span class="kw">before</span> <span class="kw">update</span> <span class="kw">of</span> takes</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">referencing</span> <span class="kw">new</span> <span class="kw">row</span> <span class="kw">as</span> nrow</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="kw">each</span> <span class="kw">row</span></span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">when</span> (nrow.grade <span class="op">=</span> ‘ ‘)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">begin</span> atomic</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span> nrow.grade <span class="op">=</span> <span class="kw">null</span>;</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
</ul>
</section>
<section id="triggering-to-maintain-credits_earned-value" class="level2">
<h2 class="anchored" data-anchor-id="triggering-to-maintain-credits_earned-value">Triggering to Maintain credits_earned value</h2>
<div class="sourceCode" id="cb126"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>  <span class="kw">create</span> <span class="kw">trigger</span> credits_earned <span class="kw">after</span> <span class="kw">update</span> <span class="kw">of</span> grade <span class="kw">on</span> takes</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">referencing</span> <span class="kw">new</span> <span class="kw">row</span> <span class="kw">as</span> nrow</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">referencing</span> <span class="kw">old</span> <span class="kw">row</span> <span class="kw">as</span> orow</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> <span class="kw">each</span> <span class="kw">row</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">when</span> nrow.grade <span class="op">&lt;&gt;</span> <span class="st">'F'</span> <span class="kw">and</span> nrow.grade <span class="kw">is</span> <span class="kw">not</span> <span class="kw">null</span> <span class="kw">and</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>       (orow.grade <span class="op">=</span> <span class="st">'F'</span> <span class="kw">or</span> orow.grade <span class="kw">is</span> <span class="kw">null</span>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">begin</span> atomic</span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>      <span class="kw">update</span> student</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>      <span class="kw">set</span> tot_cred <span class="op">=</span> tot_cred <span class="op">+</span> </span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a>          (<span class="kw">select</span> credits</span>
<span id="cb126-11"><a href="#cb126-11" aria-hidden="true" tabindex="-1"></a>          <span class="kw">from</span> course</span>
<span id="cb126-12"><a href="#cb126-12" aria-hidden="true" tabindex="-1"></a>          <span class="kw">where</span> course.course_id <span class="op">=</span> nrow.course_id)</span>
<span id="cb126-13"><a href="#cb126-13" aria-hidden="true" tabindex="-1"></a>      <span class="kw">where</span> student.<span class="kw">ID</span> <span class="op">=</span> nrow.<span class="kw">ID</span>;</span>
<span id="cb126-14"><a href="#cb126-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span>;</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="how-to-use-triggers" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use-triggers">How to use triggers?</h2>
<ul>
<li><p>The optimal use of DML triggers is for short, simple, and easy to maintain write operations that act largely independent of an applications business logic.</p></li>
<li><p>Typical and recommended uses of triggers include:</p>
<ul>
<li><em>Logging changes</em> to a history table</li>
<li><em>Auditing users and their actions</em> against sensitive tables</li>
<li><em>Adding additional values to a table</em> that may not be available to an application (due to security restrictions or other limitations), such as:
<ul>
<li>Login/user name</li>
<li>Time an operation occurs</li>
<li>Server/database name</li>
</ul></li>
<li>Simple validation</li>
</ul></li>
</ul>
</section>
<section id="how-not-to-use-triggers" class="level2">
<h2 class="anchored" data-anchor-id="how-not-to-use-triggers">How not to use triggers?</h2>
<ul>
<li>Triggers are like Lays: Once you pop, you can’t stop</li>
<li>One of the greatest challenges for architects and developers is to ensure that
<ul>
<li>triggers are used only as needed, and</li>
<li>to not allow them to become a one-size-fits-all solution for any data needs that happen to come along</li>
</ul></li>
<li>Adding triggers is often seen as faster and easier than adding code to an application, but the cost of doing so is compounded over time with each added line of code</li>
</ul>
</section>
<section id="how-to-use-triggers-2" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use-triggers-2">How to use triggers? (2)</h2>
<ul>
<li>Triggers can become dangerous when:
<ul>
<li>There are too many</li>
<li>Trigger code becomes complex</li>
<li>Triggers go cross-server - across databases over network</li>
<li>Triggers call triggers</li>
<li>Recursive triggers are set to ON. This database-level setting is set to off by default</li>
<li>Functions, stored procedures, or views are in triggers</li>
<li>Iteration occurs</li>
</ul></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>